var ExaminerShare={Resource:{initData:function(c,d,b){var a=this.DataAssembly;a.Backup.资源方式=c;a.Backup.资源类型=d;a.Backup.上传下载信息=b;Global.LoadIng.ready(function(){ExaminerShare.Resource.ElemAssembly.Other.提交按钮=$("#提交按钮")})},ElemAssembly:{Post:{},Other:{提交按钮:0}},DataAssembly:{Post:{},Backup:{资源方式:"",资源类型:"",资源ID集合:[],上传下载信息:{},资源中需交互试题数:0,资源中选择交互份数:0,试卷中所有试题总数:0,试卷中已有试题总数:0,试卷信息:{}},Similar:{上传试题_相似试题集合:{},上传试题_相似试题个数:0}},CheckBox:{update资源交互总数:function(){var a=ExaminerShare.Resource.DataAssembly.Backup;$("#资源中选择交互份数").text(a.资源中选择交互份数||0);if(a.资源类型=="试卷"){$("#试卷中所有试题总数").text(a.试卷中所有试题总数||0);$("#试卷中非有试题总数").text(a.资源中需交互试题数||0)}},update资源ID集合:function(c,h){var a=ExaminerShare.Resource.DataAssembly.Backup;if(!c.attr("disabled")){for(var g=c[0].id,f=parseInt(c[0].testInAllSubjectNum||0),e=parseInt(c[0].testInExistSubjectNum||0),b=a.资源ID集合||[],d=0;d<b.length;d++)if(b[d]==g){b.splice(d,1);a.试卷中所有试题总数-=f;a.试卷中已有试题总数-=e}if(h){b.push(g);a.试卷中所有试题总数+=f;a.试卷中已有试题总数+=e}a.资源中选择交互份数=b.length;if(a.资源类型=="试题")a.资源中需交互试题数=b.length;else{a.资源中需交互试题数=a.试卷中所有试题总数-a.试卷中已有试题总数;a.试卷信息[g]={试卷中所有试题总数:f,试卷中已有试题总数:e}}}this.update资源交互总数()},radioSelect:function(a){this.update资源ID集合($(a),a.checked)},allSelect:function(a){Global.MvcPager.CheckBox.getTR().each(function(){ExaminerShare.Resource.CheckBox.update资源ID集合(Global.MvcPager.CheckBox.getCheckBox(this),a)})},defaultSelect:function(){for(var d=ExaminerShare.Resource.DataAssembly.Backup,b=d.资源ID集合||[],c={},a=0;a<b.length;a++)c[b[a]]=true;Global.MvcPager.CheckBox.getTR().each(function(){var a=Global.MvcPager.CheckBox.getCheckBox(this),b=a[0].id;c[b]&&a.attr("checked","checked")});Global.MvcPager.CheckBox.setAll();this.update资源交互总数()}},Handle:{embedBoxyHide:function(){parent&&parent.ExaminerEmbedHandle&&parent.ExaminerEmbedHandle.Share.Boxy.hide()},embedBoxyBtn:function(a){parent&&parent.ExaminerEmbedHandle&&parent.ExaminerEmbedHandle.Share.Boxy.setCloseVis(a)},completed:function(){if(parent&&parent.ExaminerEmbedHandle){var a=ExaminerShare.Resource.DataAssembly.Backup.资源方式;parent.ExaminerEmbedHandle.Share.Update.上传下载信息(a)}}},Format:{},Boxy:{boxyKey:"Examiner-Share-Resource",getNewTitle:function(){var a=ExaminerShare.Resource.DataAssembly.Backup;return a.资源方式+a.资源类型},getTopics:function(){var a=ExaminerShare.Resource.DataAssembly.Backup;return Global.Boxy.Topics.Examiner.share(a.资源方式,a.资源类型)},progressBar:{boxImage:function(){return Global.HTML.span(null,{id:"ResourceProgressBar",style:"height: 25px;display: inline-block; background: url(/Library/Plugins/jquery.progressbar/images/progress-bar-back.gif) no-repeat;"})},progress:function(b,f){var c=ExaminerShare.Resource,d=c.DataAssembly.Backup,a=d.资源中选择交互份数,e=Math.floor(100*parseInt(b)/parseInt(a));$("#ResourceProgressBar").progressBar(e,{max:100,width:220,height:19,boxImage:"/Library/Plugins/jquery.progressbar/images/transparentBg.png",barImage:"/Library/Plugins/jquery.progressbar/images/progress-bar.gif",callback:function(d){d.running_value==d.value&&b==a&&c.Boxy.progressBar.status(b,a,f)}})},status:function(e,j,k){var d=ExaminerShare.Resource,a=d.DataAssembly.Backup,g=a.资源中选择交互份数,l=a.资源中需交互试题数,f="",c="",b="",i="";if(e==g){f=a.资源方式+"完毕";c=a.资源方式+"完毕！";b="已"}else{f="正在"+a.资源方式+"(已完成"+e+"/"+g+")";c="正在"+a.资源方式+a.资源类型;b="正在";i="第("+(e+1)+(a.资源类型=="试卷"||e+1==j?"":"-"+j)+")共"}b+=a.资源方式+i+g+(a.资源类型=="试题"?"道":"份")+a.资源类型;if(a.资源类型=="试卷")b+="(共"+l+"道试题)";b=Global.HTML.span(b,{style:"padding-left:5px;"});if(a.资源方式=="上传")c+="(来自我的"+a.资源类型+")";else{var m=Global.HTML.a("爱考网lovekao.com",{href:"http://www.lovekao.com/",target:"_blank",title:"爱考网(lovekao.com)"});c+="(来自"+m+")"}if(e==0){var h=[];h.push(b);h.push(this.boxImage());ExaminerShare.Resource.Handle.embedBoxyBtn(false);Global.Boxy.progress(d.Boxy.boxyKey,{newTitle:f,dtHtml:c,newMessage:h,ddItemIcon:false})}else{Global.Boxy.setTitle(d.Boxy.boxyKey,f);Global.Boxy.setDL_Dt(d.Boxy.boxyKey,c);Global.Boxy.setDL_DD(d.Boxy.boxyKey,0,b)}k&&k()}},wait:function(){ExaminerShare.Resource.Handle.embedBoxyBtn(false);Global.Boxy.wait(this.boxyKey,{newTitle:ExaminerShare.Resource.Boxy.getNewTitle(),dtHtml:ExaminerShare.Resource.Boxy.getTopics()})},failure:function(a){ExaminerShare.Resource.Handle.embedBoxyBtn(true);Global.Boxy.failure(this.boxyKey,{newTitle:ExaminerShare.Resource.Boxy.getNewTitle()+"失败",dtHtml:ExaminerShare.Resource.Boxy.getTopics()+"失败",newMessage:a})},success:function(){var e=ExaminerShare.Resource,b=e.DataAssembly.Backup,h=e.DataAssembly.Similar,g=b.上传下载信息.可下载试题数量,f=b.资源中选择交互份数,d=b.资源中需交互试题数,c=h.上传试题_相似试题个数,a=[];if(b.资源方式=="上传"){if(b.资源类型=="试题")a.push("您已成功上传"+(d-c)+"道试题"+(c==0?"":"(共"+f+"道，其中相似题"+c+"道)"));else a.push("您已成功上传"+f+"份试卷(共"+d+"道试题"+(c==0?"":"，其中相似题"+c+"道")+")");a.push("当前可下载试题数量为："+(g+(d-c)*10)+"道")}else{if(b.资源类型=="试题")a.push("您已成功下载"+d+"道试题");else a.push("您已成功下载"+f+"份试卷(共"+d+"道试题)");a.push("当前可下载试题数量为："+(g-d)+"道")}Global.Boxy.success(this.boxyKey,{newTitle:e.Boxy.getNewTitle()+"完成",dlStyle:"width:400px;",dtHtml:e.Boxy.getTopics()+"完成",dtStyle:"padding-top: 25px;padding-bottom: 10px;",newMessage:a,boxyOptions:{beforeHide:function(){e.Handle.embedBoxyHide()},afterHide:function(){e.Handle.completed()}}})}},postAjax:function(d,f){var c=ExaminerShare.Resource,a=c.DataAssembly.Backup,e=c.DataAssembly.Similar,b=null;if(a.资源方式=="下载"&&a.资源类型=="试卷"&&a.试卷信息[d])b=a.试卷信息[d];else b={试卷中所有试题总数:0,试卷中已有试题总数:0};Global.AjaxServer.Post.json("/Share/AjaxResource/",{resourceMode:a.资源方式,resourceType:a.资源类型,resourceID:d,testInAllSubjectNum:b.试卷中所有试题总数,testInExistSubjectNum:b.试卷中已有试题总数},function(d){if(d.result){if(a.资源方式=="上传")for(var j=d.info||{},h=j.上传试题_相似试题数组||[],i=e.上传试题_相似试题集合||{},b,g=0;g<h.length;g++){b=h[g];if(Global.Object.isUndefined(i[b.ID])){i[b.ID]=b;e.上传试题_相似试题个数+=1}}f&&f()}else c.Boxy.failure(d.info)})},separate:function(b){b=parseInt(b)||1;var a=ExaminerShare.Resource,c=a.DataAssembly.Backup,h=c.资源中选择交互份数,g=c.资源类型=="试题"?10:1,e=(b-1)*g,k=e+g,d=c.资源ID集合.slice(e,k);if(d.length==0)a.Boxy.progressBar.progress(h,function(){var b=setTimeout(function(){clearTimeout(b);a.Boxy.success()},1500)});else{var i=c.资源类型=="试题"?d:d[0],f=b==1?0:e,j=f+d.length;a.Boxy.progressBar.status(f,j,function(){a.Boxy.progressBar.progress(f,null);a.postAjax(i,function(){a.separate(b+1)})})}},submit:function(){var d=ExaminerShare.Resource,b=d.DataAssembly.Backup,c=b.上传下载信息.可下载试题数量,e=b.资源中需交互试题数,f=b.资源中选择交互份数;if(b.上传下载信息.是否绑定账号)if(b.资源方式=="下载"&&c<=0){var a=[];a.push("当前您可下载试题数量为"+Global.HTML.b(c,{style:"color:green"})+"道，请先上传试题/试卷后再下载");a.push(Global.HTML.a("我要上传试题/试卷",{target:"_top",href:"/Share/Upload/"})+"(每上传"+Global.HTML.b(1,{style:"color:green"})+"道试题可下载"+Global.HTML.b(10,{style:"color:green"})+"道试题)");d.Boxy.failure(a)}else if(f==0||e==0)d.Boxy.failure("请选择您要"+b.资源方式+"的"+b.资源类型+"！");else if(b.资源方式=="下载"&&e>c){var a=[];if(b.资源类型=="试题"){a.push("当前您已选择试题数量为"+Global.HTML.b(f,{style:"color:green"})+"道");a.push("当前您可下载试题数量为"+Global.HTML.b(c,{style:"color:green"})+"道");a.push("请取消选择"+Global.HTML.b(e-c,{style:"color:green"})+"道试题再试")}else{a.push("当前您已选择"+Global.HTML.b(f,{style:"color:green"})+"份试卷(包含"+Global.HTML.b(e,{style:"color:green"})+"道题)");a.push("当前您可下载试题数量为"+Global.HTML.b(c,{style:"color:green"})+"道");a.push("请取消选择试卷后再试")}d.Boxy.failure(a)}else d.separate(1);else{var a=[];a.push('目前您还没绑定爱考网账号！<a target="_top" href="/Binding/LKAccount/">我要绑定账号</a>');d.Boxy.failure(a)}}}}