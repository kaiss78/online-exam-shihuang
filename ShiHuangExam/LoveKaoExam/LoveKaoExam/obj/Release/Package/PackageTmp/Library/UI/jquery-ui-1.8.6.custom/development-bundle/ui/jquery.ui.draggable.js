(function(a){a.widget("ui.draggable",a.ui.mouse,{widgetEventPrefix:"drag",options:{addClasses:true,appendTo:"parent",axis:false,connectToSortable:false,containment:false,cursor:"auto",cursorAt:false,grid:false,handle:false,helper:"original",iframeFix:false,opacity:false,refreshPositions:false,revert:false,revertDuration:500,scope:"default",scroll:true,scrollSensitivity:20,scrollSpeed:20,snap:false,snapMode:"both",snapTolerance:20,stack:false,zIndex:false},_create:function(){if(this.options.helper=="original"&&!/^(?:r|a|f)/.test(this.element.css("position")))this.element[0].style.position="relative";this.options.addClasses&&this.element.addClass("ui-draggable");this.options.disabled&&this.element.addClass("ui-draggable-disabled");this._mouseInit()},destroy:function(){if(!this.element.data("draggable"))return;this.element.removeData("draggable").unbind(".draggable").removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled");this._mouseDestroy();return this},_mouseCapture:function(b){var c=this.options;if(this.helper||c.disabled||a(b.target).is(".ui-resizable-handle"))return false;this.handle=this._getHandle(b);return!this.handle?false:true},_mouseStart:function(b){var c=this.options;this.helper=this._createHelper(b);this._cacheHelperProportions();if(a.ui.ddmanager)a.ui.ddmanager.current=this;this._cacheMargins();this.cssPosition=this.helper.css("position");this.scrollParent=this.helper.scrollParent();this.offset=this.positionAbs=this.element.offset();this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left};a.extend(this.offset,{click:{left:b.pageX-this.offset.left,top:b.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});this.originalPosition=this.position=this._generatePosition(b);this.originalPageX=b.pageX;this.originalPageY=b.pageY;c.cursorAt&&this._adjustOffsetFromHelper(c.cursorAt);c.containment&&this._setContainment();if(this._trigger("start",b)===false){this._clear();return false}this._cacheHelperProportions();a.ui.ddmanager&&!c.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b);this.helper.addClass("ui-draggable-dragging");this._mouseDrag(b,true);return true},_mouseDrag:function(b,d){this.position=this._generatePosition(b);this.positionAbs=this._convertPositionTo("absolute");if(!d){var c=this._uiHash();if(this._trigger("drag",b,c)===false){this._mouseUp({});return false}this.position=c.position}if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||this.options.axis!="x")this.helper[0].style.top=this.position.top+"px";a.ui.ddmanager&&a.ui.ddmanager.drag(this,b);return false},_mouseStop:function(c){var b=false;if(a.ui.ddmanager&&!this.options.dropBehaviour)b=a.ui.ddmanager.drop(this,c);if(this.dropped){b=this.dropped;this.dropped=false}if(!this.element[0]||!this.element[0].parentNode)return false;if(this.options.revert=="invalid"&&!b||this.options.revert=="valid"&&b||this.options.revert===true||a.isFunction(this.options.revert)&&this.options.revert.call(this.element,b)){var d=this;a(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){d._trigger("stop",c)!==false&&d._clear()})}else this._trigger("stop",c)!==false&&this._clear();return false},cancel:function(){if(this.helper.is(".ui-draggable-dragging"))this._mouseUp({});else this._clear();return this},_getHandle:function(c){var b=!this.options.handle||!a(this.options.handle,this.element).length?true:false;a(this.options.handle,this.element).find("*").andSelf().each(function(){if(this==c.target)b=true});return b},_createHelper:function(d){var c=this.options,b=a.isFunction(c.helper)?a(c.helper.apply(this.element[0],[d])):c.helper=="clone"?this.element.clone():this.element;!b.parents("body").length&&b.appendTo(c.appendTo=="parent"?this.element[0].parentNode:c.appendTo);b[0]!=this.element[0]&&!/(fixed|absolute)/.test(b.css("position"))&&b.css("position","absolute");return b},_adjustOffsetFromHelper:function(b){if(typeof b=="string")b=b.split(" ");if(a.isArray(b))b={left:+b[0],top:+b[1]||0};if("left"in b)this.offset.click.left=b.left+this.margins.left;if("right"in b)this.offset.click.left=this.helperProportions.width-b.right+this.margins.left;if("top"in b)this.offset.click.top=b.top+this.margins.top;if("bottom"in b)this.offset.click.top=this.helperProportions.height-b.bottom+this.margins.top},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var b=this.offsetParent.offset();if(this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&a.ui.contains(this.scrollParent[0],this.offsetParent[0])){b.left+=this.scrollParent.scrollLeft();b.top+=this.scrollParent.scrollTop()}if(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&a.browser.msie)b={top:0,left:0};return{top:b.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:b.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var a=this.element.position();return{top:a.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:a.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}else return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var c=this.options;if(c.containment=="parent")c.containment=this.helper[0].parentNode;if(c.containment=="document"||c.containment=="window")this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,a(c.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(a(c.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!/^(document|window|parent)$/.test(c.containment)&&c.containment.constructor!=Array){var b=a(c.containment)[0];if(!b)return;var d=a(c.containment).offset(),e=a(b).css("overflow")!="hidden";this.containment=[d.left+(parseInt(a(b).css("borderLeftWidth"),10)||0)+(parseInt(a(b).css("paddingLeft"),10)||0)-this.margins.left,d.top+(parseInt(a(b).css("borderTopWidth"),10)||0)+(parseInt(a(b).css("paddingTop"),10)||0)-this.margins.top,d.left+(e?Math.max(b.scrollWidth,b.offsetWidth):b.offsetWidth)-(parseInt(a(b).css("borderLeftWidth"),10)||0)-(parseInt(a(b).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,d.top+(e?Math.max(b.scrollHeight,b.offsetHeight):b.offsetHeight)-(parseInt(a(b).css("borderTopWidth"),10)||0)-(parseInt(a(b).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]}else if(c.containment.constructor==Array)this.containment=c.containment},_convertPositionTo:function(f,c){if(!c)c=this.position;var b=f=="absolute"?1:-1,g=this.options,d=this.cssPosition=="absolute"&&!(this.scrollParent[0]!=document&&a.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,e=/(html|body)/i.test(d[0].tagName);return{top:c.top+this.offset.relative.top*b+this.offset.parent.top*b-(a.browser.safari&&a.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():e?0:d.scrollTop())*b),left:c.left+this.offset.relative.left*b+this.offset.parent.left*b-(a.browser.safari&&a.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():e?0:d.scrollLeft())*b)}},_generatePosition:function(e){var b=this.options,h=this.cssPosition=="absolute"&&!(this.scrollParent[0]!=document&&a.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,i=/(html|body)/i.test(h[0].tagName),f=e.pageX,g=e.pageY;if(this.originalPosition){if(this.containment){if(e.pageX-this.offset.click.left<this.containment[0])f=this.containment[0]+this.offset.click.left;if(e.pageY-this.offset.click.top<this.containment[1])g=this.containment[1]+this.offset.click.top;if(e.pageX-this.offset.click.left>this.containment[2])f=this.containment[2]+this.offset.click.left;if(e.pageY-this.offset.click.top>this.containment[3])g=this.containment[3]+this.offset.click.top}if(b.grid){var d=this.originalPageY+Math.round((g-this.originalPageY)/b.grid[1])*b.grid[1];g=this.containment?!(d-this.offset.click.top<this.containment[1]||d-this.offset.click.top>this.containment[3])?d:!(d-this.offset.click.top<this.containment[1])?d-b.grid[1]:d+b.grid[1]:d;var c=this.originalPageX+Math.round((f-this.originalPageX)/b.grid[0])*b.grid[0];f=this.containment?!(c-this.offset.click.left<this.containment[0]||c-this.offset.click.left>this.containment[2])?c:!(c-this.offset.click.left<this.containment[0])?c-b.grid[0]:c+b.grid[0]:c}}return{top:g-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(a.browser.safari&&a.browser.version<526&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollTop():i?0:h.scrollTop()),left:f-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(a.browser.safari&&a.browser.version<526&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():i?0:h.scrollLeft())}},_clear:function(){this.helper.removeClass("ui-draggable-dragging");this.helper[0]!=this.element[0]&&!this.cancelHelperRemoval&&this.helper.remove();this.helper=null;this.cancelHelperRemoval=false},_trigger:function(c,d,b){b=b||this._uiHash();a.ui.plugin.call(this,c,[d,b]);if(c=="drag")this.positionAbs=this._convertPositionTo("absolute");return a.Widget.prototype._trigger.call(this,c,d,b)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}});a.extend(a.ui.draggable,{version:"1.8.6"});a.ui.plugin.add("draggable","connectToSortable",{start:function(d,e){var b=a(this).data("draggable"),f=b.options,c=a.extend({},e,{item:b.element});b.sortables=[];a(f.connectToSortable).each(function(){var e=a.data(this,"sortable");if(e&&!e.options.disabled){b.sortables.push({instance:e,shouldRevert:e.options.revert});e._refreshItems();e._trigger("activate",d,c)}})},stop:function(c,e){var b=a(this).data("draggable"),d=a.extend({},e,{item:b.element});a.each(b.sortables,function(){if(this.instance.isOver){this.instance.isOver=0;b.cancelHelperRemoval=true;this.instance.cancelHelperRemoval=false;if(this.shouldRevert)this.instance.options.revert=true;this.instance._mouseStop(c);this.instance.options.helper=this.instance.options._helper;b.options.helper=="original"&&this.instance.currentItem.css({top:"auto",left:"auto"})}else{this.instance.cancelHelperRemoval=false;this.instance._trigger("deactivate",c,d)}})},drag:function(c,e){var b=a(this).data("draggable"),d=this,f=function(b){var i=this.offset.click.top,h=this.offset.click.left,e=this.positionAbs.top,c=this.positionAbs.left,d=b.height,f=b.width,j=b.top,g=b.left;return a.ui.isOver(e+i,c+h,j,g,d,f)};a.each(b.sortables,function(){this.instance.positionAbs=b.positionAbs;this.instance.helperProportions=b.helperProportions;this.instance.offset.click=b.offset.click;if(this.instance._intersectsWith(this.instance.containerCache)){if(!this.instance.isOver){this.instance.isOver=1;this.instance.currentItem=a(d).clone().appendTo(this.instance.element).data("sortable-item",true);this.instance.options._helper=this.instance.options.helper;this.instance.options.helper=function(){return e.helper[0]};c.target=this.instance.currentItem[0];this.instance._mouseCapture(c,true);this.instance._mouseStart(c,true,true);this.instance.offset.click.top=b.offset.click.top;this.instance.offset.click.left=b.offset.click.left;this.instance.offset.parent.left-=b.offset.parent.left-this.instance.offset.parent.left;this.instance.offset.parent.top-=b.offset.parent.top-this.instance.offset.parent.top;b._trigger("toSortable",c);b.dropped=this.instance.element;b.currentItem=b.element;this.instance.fromOutside=b}this.instance.currentItem&&this.instance._mouseDrag(c)}else if(this.instance.isOver){this.instance.isOver=0;this.instance.cancelHelperRemoval=true;this.instance.options.revert=false;this.instance._trigger("out",c,this.instance._uiHash(this.instance));this.instance._mouseStop(c,true);this.instance.options.helper=this.instance.options._helper;this.instance.currentItem.remove();this.instance.placeholder&&this.instance.placeholder.remove();b._trigger("fromSortable",c);b.dropped=false}})}});a.ui.plugin.add("draggable","cursor",{start:function(){var b=a("body"),c=a(this).data("draggable").options;if(b.css("cursor"))c._cursor=b.css("cursor");b.css("cursor",c.cursor)},stop:function(){var b=a(this).data("draggable").options;b._cursor&&a("body").css("cursor",b._cursor)}});a.ui.plugin.add("draggable","iframeFix",{start:function(){var b=a(this).data("draggable").options;a(b.iframeFix===true?"iframe":b.iframeFix).each(function(){a('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(a(this).offset()).appendTo("body")})},stop:function(){a("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)})}});a.ui.plugin.add("draggable","opacity",{start:function(e,d){var b=a(d.helper),c=a(this).data("draggable").options;if(b.css("opacity"))c._opacity=b.css("opacity");b.css("opacity",c.opacity)},stop:function(d,c){var b=a(this).data("draggable").options;b._opacity&&a(c.helper).css("opacity",b._opacity)}});a.ui.plugin.add("draggable","scroll",{start:function(){var b=a(this).data("draggable");if(b.scrollParent[0]!=document&&b.scrollParent[0].tagName!="HTML")b.overflowOffset=b.scrollParent.offset()},drag:function(e){var c=a(this).data("draggable"),b=c.options,d=false;if(c.scrollParent[0]!=document&&c.scrollParent[0].tagName!="HTML"){if(!b.axis||b.axis!="x")if(c.overflowOffset.top+c.scrollParent[0].offsetHeight-e.pageY<b.scrollSensitivity)c.scrollParent[0].scrollTop=d=c.scrollParent[0].scrollTop+b.scrollSpeed;else if(e.pageY-c.overflowOffset.top<b.scrollSensitivity)c.scrollParent[0].scrollTop=d=c.scrollParent[0].scrollTop-b.scrollSpeed;if(!b.axis||b.axis!="y")if(c.overflowOffset.left+c.scrollParent[0].offsetWidth-e.pageX<b.scrollSensitivity)c.scrollParent[0].scrollLeft=d=c.scrollParent[0].scrollLeft+b.scrollSpeed;else if(e.pageX-c.overflowOffset.left<b.scrollSensitivity)c.scrollParent[0].scrollLeft=d=c.scrollParent[0].scrollLeft-b.scrollSpeed}else{if(!b.axis||b.axis!="x")if(e.pageY-a(document).scrollTop()<b.scrollSensitivity)d=a(document).scrollTop(a(document).scrollTop()-b.scrollSpeed);else if(a(window).height()-(e.pageY-a(document).scrollTop())<b.scrollSensitivity)d=a(document).scrollTop(a(document).scrollTop()+b.scrollSpeed);if(!b.axis||b.axis!="y")if(e.pageX-a(document).scrollLeft()<b.scrollSensitivity)d=a(document).scrollLeft(a(document).scrollLeft()-b.scrollSpeed);else if(a(window).width()-(e.pageX-a(document).scrollLeft())<b.scrollSensitivity)d=a(document).scrollLeft(a(document).scrollLeft()+b.scrollSpeed)}d!==false&&a.ui.ddmanager&&!b.dropBehaviour&&a.ui.ddmanager.prepareOffsets(c,e)}});a.ui.plugin.add("draggable","snap",{start:function(){var b=a(this).data("draggable"),c=b.options;b.snapElements=[];a(c.snap.constructor!=String?c.snap.items||":data(draggable)":c.snap).each(function(){var c=a(this),d=c.offset();this!=b.element[0]&&b.snapElements.push({item:this,width:c.outerWidth(),height:c.outerHeight(),top:d.top,left:d.left})})},drag:function(s,e){for(var b=a(this).data("draggable"),r=b.options,c=r.snapTolerance,j=e.offset.left,l=j+b.helperProportions.width,k=e.offset.top,m=k+b.helperProportions.height,d=b.snapElements.length-1;d>=0;d--){var f=b.snapElements[d].left,i=f+b.snapElements[d].width,g=b.snapElements[d].top,h=g+b.snapElements[d].height;if(!(f-c<j&&j<i+c&&g-c<k&&k<h+c||f-c<j&&j<i+c&&g-c<m&&m<h+c||f-c<l&&l<i+c&&g-c<k&&k<h+c||f-c<l&&l<i+c&&g-c<m&&m<h+c)){if(b.snapElements[d].snapping)b.options.snap.release&&b.options.snap.release.call(b.element,s,a.extend(b._uiHash(),{snapItem:b.snapElements[d].item}));b.snapElements[d].snapping=false;continue}if(r.snapMode!="inner"){var q=Math.abs(g-m)<=c,n=Math.abs(h-k)<=c,o=Math.abs(f-l)<=c,p=Math.abs(i-j)<=c;if(q)e.position.top=b._convertPositionTo("relative",{top:g-b.helperProportions.height,left:0}).top-b.margins.top;if(n)e.position.top=b._convertPositionTo("relative",{top:h,left:0}).top-b.margins.top;if(o)e.position.left=b._convertPositionTo("relative",{top:0,left:f-b.helperProportions.width}).left-b.margins.left;if(p)e.position.left=b._convertPositionTo("relative",{top:0,left:i}).left-b.margins.left}var t=q||n||o||p;if(r.snapMode!="outer"){var q=Math.abs(g-k)<=c,n=Math.abs(h-m)<=c,o=Math.abs(f-j)<=c,p=Math.abs(i-l)<=c;if(q)e.position.top=b._convertPositionTo("relative",{top:g,left:0}).top-b.margins.top;if(n)e.position.top=b._convertPositionTo("relative",{top:h-b.helperProportions.height,left:0}).top-b.margins.top;if(o)e.position.left=b._convertPositionTo("relative",{top:0,left:f}).left-b.margins.left;if(p)e.position.left=b._convertPositionTo("relative",{top:0,left:i-b.helperProportions.width}).left-b.margins.left}if(!b.snapElements[d].snapping&&(q||n||o||p||t))b.options.snap.snap&&b.options.snap.snap.call(b.element,s,a.extend(b._uiHash(),{snapItem:b.snapElements[d].item}));b.snapElements[d].snapping=q||n||o||p||t}}});a.ui.plugin.add("draggable","stack",{start:function(){var d=a(this).data("draggable").options,b=a.makeArray(a(d.stack)).sort(function(b,c){return(parseInt(a(b).css("zIndex"),10)||0)-(parseInt(a(c).css("zIndex"),10)||0)});if(!b.length)return;var c=parseInt(b[0].style.zIndex)||0;a(b).each(function(a){this.style.zIndex=c+a});this[0].style.zIndex=c+b.length}});a.ui.plugin.add("draggable","zIndex",{start:function(e,d){var b=a(d.helper),c=a(this).data("draggable").options;if(b.css("zIndex"))c._zIndex=b.css("zIndex");b.css("zIndex",c.zIndex)},stop:function(d,c){var b=a(this).data("draggable").options;b._zIndex&&a(c.helper).css("zIndex",b._zIndex)}})})(jQuery)