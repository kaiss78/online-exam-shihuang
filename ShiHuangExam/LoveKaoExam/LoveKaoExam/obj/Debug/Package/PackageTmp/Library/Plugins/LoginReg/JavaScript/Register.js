$(function(){LKRegister.init_reg();LKRegister.exe_reload_code(false)});$(document).keydown(function(a){if(a.keyCode==13){LKRegister.submit_reg_re();return false}});var LKRegister={elem_text_uname:0,elem_text_upawd_1:0,elem_text_upawd_2:0,elem_text_uemail:0,elem_text_vcode:0,elem_text_uname_len:0,elem_text_upawd_1_level:0,elem_button_reg:0,options:{isiframe:false},init_reg:function(){var a=GlobalManage.getUrlArg(),b=a.isiframe,d=a.uname,c=a.uemail;this.options.isiframe=b=="true"?true:false;this.init_login();this.elem_text_uname=$("#uname").focus();this.elem_text_upawd_1=$("#upawd_1");this.elem_text_upawd_2=$("#upawd_2");this.elem_text_uemail=$("#uemail");this.elem_text_vcode=$("#vcode")},init_login:function(){var a=document.getElementById("Reg_Login")||{},b="/Common/LoginReg/Login.htm?isiframe="+(this.options.isiframe?"true":"false");a.href=b},init_text:function(){this.elem_text_uname_len=this.elem_text_uname_len||$("#uname_len");this.elem_text_upawd_1_level=this.elem_text_upawd_1_level||$("#upawd_1_level")},init_button:function(){this.elem_button_reg=this.elem_button_reg||$("#button_reg")},trim:function(a){return(a||"").replace(/(^\s*)|(\s*$)/g,"")},getOffset:function(c){var a=$(c),d=a.offset().top,b=a.offset().left;return{top:d,left:b}},getPosition:function(c){var a=$(c),d=a.position().top,b=a.position().left;return{top:d,left:b}},getStrLen:function(c){for(var a=0,d=c.length,b=0;b<d;b++)if(c.charCodeAt(b)>255)a+=2;else a++;return a},getUpperCase:function(a){return(a||"").toUpperCase()},get_pawd_level:function(b){var a=0;if(b.length==0)a+=0;else if(b.length>0&&b.length<8)a+=5;else if(b.length>10)a+=25;else a+=10;var i=false,j=false,k=b.match(/[A-Z]{1}/),l=b.match(/[a-z]{1}/);if(k==null&&l==null){a+=0;i=false}else if(k!=null&&l!=null){a+=20;j=true}else{a+=10;j=true}for(var e=false,g=0,c=0;c<b.length;c++)if(b.charAt(c)<="9"&&b.charAt(c)>="0"){e=true;g+=1}if(g==0){a+=0;e=false}else if(g>2){a+=20;e=true}else{a+=10;e=true}for(var f=false,h=0,c=0;c<b.length;c++){if(b.charAt(c)>="0"&&b.charAt(c)<="9"||b.charAt(c)>="A"&&b.charAt(c)<="Z"||b.charAt(c)>="a"&&b.charAt(c)<="z")continue;h+=1;f=true}if(h==0){a+=0;f=false}else if(h>1){a+=25;f=true}else{a+=10;f=true}if(j&&e&&f)a+=5;else if(i&&e&&f)a+=3;else if(i&&e)a+=2;var d="";if(a>=90)d="level_8";else if(a>=80)d="level_7";else if(a>=70)d="level_6";else if(a>=60)d="level_5";else if(a>=50)d="level_4";else if(a>25)d="level_3";else if(a>0)d="level_2";else d="level_1";return d},get_lk_lr:function(){return this.options.isiframe?parent.LK_LoginReg:LK_LoginReg},set_boxy_title:function(){var a=this.get_lk_lr();a&&a.title("登录")},goto_login:function(c){var a=this.trim(this["elem_text_"+c].val());if(this.options.isiframe)window.location.href="/Common/LoginReg/Login.htm?isiframe=true&uname="+a;else{var b=parent.LK_LoginReg||LK_LoginReg;b.show({是否都要打开窗口:true,是否现登录或注册成功回调函数:true,用户名:a,预回调函数:function(){window.location.href="/"}})}return false},data:{allow:{uname:"",uemail:""},exist:{uname:{},uemail:{}},input:["uname","upawd_1","upawd_2","uemail","vcode"],input_focus:{uname:true,upawd_1:true,upawd_2:true,uemail:true,vcode:true}},tipMsg_data:{uname_empty:"用户名由大小写英文字母、数字4-16个<br />字符组成。",uname_format:"格式错误,请用大小写英文字母、数字4-<br />16个字符。",uname_already:'该用户名已经在爱考网注册！<br/>请换一个用户名注册，或直接<a class="link" href="javascript:void(0)" onclick="return LKRegister.goto_login(\'uname\');" title="使用此用户名登录" >使用此用户名登录</a>',uname_overtime:'很抱歉！验证已超时，点击重新<a class="ref-link link" href="javascript:void(0)" onclick="LKRegister.exe_check(null,\'uname\',\'submit\');">验证</a>',uname_exception:'很抱歉！连接服务器失败，请稍后再试<br />或点击重新<a class="ref-link link" href="javascript:void(0)" onclick="LKRegister.exe_check(null,\'uname\',\'submit\');">验证</a>',upawd_1_empty:"密码有6-16大小写英文字母、数字或<br/>特殊字符组成。",upawd_1_format:"请输入6～16位字符的密码！",upawd_2_empty:"请再次输入密码！",upawd_2_differ:"两次输入的密码不一样，请重输！",uemail_empty:'请输入您常用的邮箱，方便日后找回密码。<br />没有电子邮箱？推荐使用<span id="tjyx" onclick="LKRegister.tipMsg_hide(\'uemail\');" ><a id="YaHu" href="http://mail.cn.yahoo.com/" target="_blank" style="color:#336699;">雅虎邮箱</a>、<a id="WangYi" target="_blank" href="http://mail.163.com/" style="color:#336699" >网易邮箱</a></span>',uemail_format:"Email格式错误，请重新输入！",uemail_already:'该邮箱已经在爱考网注册！<br/>请换一个邮箱注册，或直接<a class="link" href="javascript:void(0)" onclick="return LKRegister.goto_login(\'uemail\');" title="使用此邮箱登录" >使用此邮箱登录</a>',uemail_overtime:'很抱歉！验证已超时，点击重新<a class="ref-link link" href="javascript:void(0)" onclick="LKRegister.exe_check(null,\'uemail\',\'submit\');">验证</a>',uemail_exception:'很抱歉！连接服务器失败，请稍后再试<br />或点击重新<a class="ref-link link" href="javascript:void(0)" onclick="LKRegister.exe_check(null,\'uemail\',\'submit\');">验证</a>',vcode_empty:"请输入验证码！",vcode_differ:"验证码错误了，请重新填写！",vcode_overtime:"验证码已过期了，请换一张再试！"},tipMsg_init:function(a){this["tipMsg_box"+a]=this["tipMsg_box"+a]||new MsgBox("",{isTipMsg:false,bgColor:"#fff"})},tipMsg_get:function(a){typeof this["tipMsg_box"+a]=="undefined"&&this.tipMsg_init(a);return this["tipMsg_box"+a]},tipMsg_show:function(c,a,b){this.tipMsg_site(c,a);this.tipMsg_bg(a,b);this.tipMsg_get(a).show({speed:1})},tipMsg_hide:function(a){this.tipMsg_get(a).hide()},tipMsg_bg:function(b,a){this.tipMsg_get(b).setBgColor(a?"#ffffcd":"#fff")},tipMsg_cont:function(b,a){a='<div class="tipmsg-inner">'+a+"</div>";this.tipMsg_get(b).setContent(a)},tipMsg_site:function(b,c){b=b?$(b):this["elem_text_"+c];var a=this.getOffset(b);switch(c){case"vcode":a.left+=300;break;default:a.left+=250}a.top-=2;this.tipMsg_get(c).setElemAnimate(a)},exe_focus:function(b,a,c){this.field_set(a,true);if(this.icon_able_get(a)!="no"){b=b?$(b):this["elem_text_"+a];b[0].className="text text-focus";this.tipMsg_cont(a,this.tipMsg_data[a+"_empty"]);this.tipMsg_show(b,a,c);this.exe_uemail_link(a)}},exe_uname_len:function(a){this.init_text();a=a?$(a):this.elem_text_uname;var b=a.val();if(b=="")this.elem_text_uname_len.text("");else this.elem_text_uname_len.text(this.getStrLen(b)+"个字符")},exe_upawd_level:function(a){this.init_text();a=a?$(a):this.elem_text_upawd_1;var d=a.val(),b=this.elem_text_upawd_1_level,c=b.parent("div.upawd_level-box");if(d==""){b[0].className="upawd_level level_1";c.css("display","none")}else{var e=this.get_pawd_level(d);b[0].className="upawd_level "+e;c.css("display","block")}},exe_reload_code:function(c){var a=document.getElementById("img_vcode");if(a){a.onload=function(){this.style.display="inline"};a.src="/Common/LoginReg/VerifyCode.aspx?rnd="+Math.random()}if(c){if(this.trim(this.elem_text_vcode.val())==""){var b=$("#icon_vcode");b[0].className="icon-box";b.attr("isable","no")}else{this.icon_able_set("vcode",false,false);this.tipMsg_unable_set(null,"vcode","vcode_differ",null)}this.elem_text_vcode.select()}},exe_allow_get:function(a,b){return this.data.allow[a]==b},exe_allow_set:function(a,b){this.data.allow[a]=b},exe_exist_get:function(a,b){return this.data.exist[a][b]==true},exe_exist_set:function(a,b){this.data.exist[a][b]=true},tipMsg_unable_get:function(a){return this.tipMsg_data[a]},tipMsg_unable_set:function(d,a,c,b){this.tipMsg_cont(a,this.tipMsg_unable_get(c));this.tipMsg_show(d,a,true);this.icon_able_set(a,false,false);this["elem_text_"+a][0].className="text text-error";b&&b(false)},tipMsg_able_set:function(a,b){this.tipMsg_hide(a);this.icon_able_set(a,false,true);b&&b(true)},icon_able_get:function(a){return $("#icon_"+a).attr("isable")},icon_able_set:function(d,c,b){var a=$("#icon_"+d);if(c){a[0].className="icon-box";a.attr("isable","yes")}else{a[0].className="icon-box "+(b?"icon-gou":"icon-cha");a.attr("isable",b?"yes":"no")}},field_set:function(a,b){var c=document.getElementById("field_"+a)||{};switch(a){case"vcode":break;default:c.className=b?"field-focus":"field-blur"}},exe_text_select:function(a){this["elem_text_"+a].select().focus()},is_uemail_link:false,exe_uemail_link:function(c){var a=this;this.is_uemail_link=false;if(c=="uemail"){var b=$("#tjyx",this.tipMsg_get("uemail").getInner());b.hover(function(){a.is_uemail_link=true},function(){a.is_uemail_link=false})}},exe_check_format:function(e,b,d,c){var a=this;switch(b){case"uname":if(!/^[A-Za-z0-9]{4,16}$/.test(d))a.tipMsg_unable_set(e,b,"uname_format",c);else if(a.getStrLen(d)<4||a.getStrLen(d)>16)a.tipMsg_unable_set(e,b,"uname_format",c);else if(this.exe_exist_get("uname",d))a.tipMsg_unable_set(e,b,"uname_already",c);else if(this.exe_allow_get("uname",d))a.tipMsg_able_set(b,c);else{a.tipMsg_hide(b);a.icon_able_set(b,true,null);$.ajax({url:"/Common/Ajax/Log_Reg.aspx",data:{action:"log_reg_验证用户名",uname:d},dataType:"json",timeout:6e4,cache:false,success:function(d){if(d.result){a.exe_allow_set("uname",d.info);a.tipMsg_able_set(b,c)}else if(d.type=="用户名已存在"){a.exe_exist_set("uname",d.info);a.tipMsg_unable_set(e,b,"uname_already",c)}else a.tipMsg_unable_set(e,b,"uname_exception",c)},error:function(f,d){switch(d){case"timeout":a.tipMsg_unable_set(e,b,"uname_overtime",c);break;default:c&&c(false)}}})}break;case"upawd_1":if(d.length<6||d.length>16)a.tipMsg_unable_set(e,b,"upawd_1_format",c);else if(d==a.elem_text_upawd_2.val()){a.tipMsg_hide("upawd_2");a.elem_text_upawd_2[0].className="text";a.icon_able_set("upawd_2",false,true);a.tipMsg_able_set(b,c)}else a.tipMsg_able_set(b,c);break;case"upawd_2":if(d.length<6||d.length>16)a.tipMsg_unable_set(e,b,"upawd_1_format",c);else if(d!=a.elem_text_upawd_1.val())a.tipMsg_unable_set(e,b,"upawd_2_differ",c);else a.tipMsg_able_set(b,c);break;case"uemail":if(!/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/.test(d))a.tipMsg_unable_set(e,b,"uemail_format",c);else if(this.exe_exist_get("uemail",d))a.tipMsg_unable_set(e,b,"uemail_already",c);else if(this.exe_allow_get("uemail",d))a.tipMsg_able_set(b,c);else{a.tipMsg_hide(b);a.icon_able_set(b,true,null);$.ajax({url:"/Common/Ajax/Log_Reg.aspx",data:{action:"log_reg_验证邮箱地址",uemail:d},dataType:"json",timeout:6e4,cache:false,success:function(d){if(d.result){a.exe_allow_set("uemail",d.info);a.tipMsg_able_set(b,c)}else if(d.type=="邮箱地址已存在"){a.exe_exist_set("uemail",d.info);a.tipMsg_unable_set(e,b,"uemail_already",c)}else a.tipMsg_unable_set(e,b,"uemail_exception",c)},error:function(f,d){switch(d){case"timeout":a.tipMsg_unable_set(e,b,"uemail_overtime",c);break;default:c&&c(false)}}})}break;case"vcode":var f=GlobalManage.getCookie("c_ver_code",null,null);if(a.getUpperCase(d)!=f)a.tipMsg_unable_set(e,b,"vcode_differ",c);else a.tipMsg_able_set(b,c)}},exe_check:function(b,a,c,e){b=b?$(b):this["elem_text_"+a];b[0].className="text";this.field_set(a,false);var d=this.trim(b[0].value);if(d==""){if(a=="uemail"&&this.is_uemail_link)return;if(c=="blur"){this.tipMsg_hide(a);this.icon_able_set(a,true,null)}else if(c=="submit"){this.tipMsg_unable_set(b,a,a+"_empty",e);this.icon_able_set(a,false,false)}}else this.exe_check_format(b,a,d,e)},switch_win:function(b){var c=$("#Register"),d=$("#FulFill"),a=b.s_email,f=this;if(a!=""){var e=(a||"").replace(/http:\/\/mail./,"");$("#reg_uemail").html('<a href="'+a+'" class="link" target="_blank">访问'+e+"邮箱</a>")}$("#reg_uname").text(b.uname);c.fadeOut("fast",function(){d.fadeIn("fast",function(){f.exe_submit_set({is提交状态:false,is提交按钮:false,is对话框按钮:true,is可点击链接:false})})})},exe_boxy_hide:function(){var a=this.get_lk_lr();a&&a.hide()},time_id:0,exe_timeout:function(a){this.time_id!=0&&clearTimeout(this.time_id);if(a){var b=this;this.time_id=setTimeout(function(){b.exe_boxy_hide()},5e3)}else this.exe_boxy_hide()},issubmit:false,exe_submit_set:function(a){this.init_button();var b=a.is提交状态||false;if(a.is提交按钮)if(b){this.issubmit=true;this.elem_button_reg.attr("disabled","disabled")}else{this.issubmit=false;this.elem_button_reg.removeAttr("disabled")}if(a.is对话框按钮){var c=this.get_lk_lr();c&&c.close_btn(!b)}a.is可点击链接&&$("#account").css("display",b?"none":"block")},submit_reg_re:function(){this.init_button();this.elem_button_reg.click()},submit_reg_clear:function(){this.elem_text_uname.val("");this.elem_text_upawd_1.val("");this.elem_text_upawd_2.val("");this.elem_text_uemail.val("");this.elem_text_vcode.val("")},submit_reg_success:function(a){var b=this.get_lk_lr();if(b)b.data.现登录或注册已成功=true;this.submit_reg_clear();if(this.options.isiframe){this.switch_win(a);this.exe_timeout(true)}else window.location.href="/Reg/RegMail.aspx?en_email="+(a.en_email||"")+"&s_email="+(a.s_email||"")+"&en_uname="+(a.en_uname||"")},submit_reg_ajax:function(){var a=this;$.ajax({url:"/Common/Ajax/Log_Reg.aspx",data:{action:"log_reg_注册",uname:a.trim(a.elem_text_uname.val()),upawd:a.trim(a.elem_text_upawd_1.val()),uemail:a.trim(a.elem_text_uemail.val())},dataType:"json",timeout:6e4,cache:false,success:function(b){if(b.result){a.submit_reg_success(b);return}else if(b.type=="exist_uname"){a.exe_exist_set("uname",a.trim(b.info));a.exe_check(null,"uname","submit",null);a.exe_text_select("uname")}else if(b.type=="exist_uemail"){a.exe_exist_set("uemail",a.trim(b.info));a.exe_check(null,"uemail","submit",null);a.exe_text_select("uemail")}else alert(b.info);a.exe_submit_set({is提交状态:false,is提交按钮:true,is对话框按钮:true,is可点击链接:true})},error:function(c,b){switch(b){case"timeout":alert("对不起！提交注册超时了，请重新提交")}a.exe_submit_set({is提交状态:false,is提交按钮:true,is对话框按钮:true,is可点击链接:true})}})},submit_reg:function(){if(this.issubmit)return false;this.exe_submit_set({is提交状态:true,is提交按钮:true,is对话框按钮:true,is可点击链接:true});for(var e=0,f=this.data.input,b,d=f.length,c=this,a=0;a<d;a++){b=f[a];this.exe_check(null,b,"submit",function(f){if(f)e++;else{a=d;c.exe_submit_set({is提交状态:false,is提交按钮:true,is对话框按钮:true,is可点击链接:true});c.exe_text_select(b)}e==d&&c.submit_reg_ajax()})}}}