$(function(){RecogPageManage.ready()});var RecogPageManage={ready:function(){RecogLibSubject.initElem()}},RecogLibSetManage={normalHigh:{letterFore:"",letterAfter:"",number:"",isTitle:true,isTrim:true,isUpperCase:true},currentHigh:{letterFore:"",letterAfter:"",number:"",isTitle:true,isTrim:true,isUpperCase:true},tempHigh:{letterFore:"",letterAfter:"",number:"",isTitle:true,isTrim:true,isUpperCase:true},chars:{number:"%&#Number#&%",upperCase:"%&#UpperCase#&%",lowerCase:"%&#LowerCase#&%",special:" (　)（）.．"},option:{T11:{min:2,max:10},T12:{min:2,max:10},T14:{min:3,max:20},T15:{min:2,max:4},T8011:{min:2,max:10}},space:{T13:{min:1,max:10},T14:{min:1,max:15},T15:{min:1,max:25}},names:{T10:"自由题",T11:"单选题",T12:"多选题",T13:"填空题",T14:"选词填空",T15:"完形填空",T20:"判断题",T30:"连线题",T40:"复合题",T41:"诗词鉴赏",T42:"阅读理解",T43:"快速阅读",T44:"文言文",T45:"现代文",T46:"材料分析",T47:"案例分析",T50:"改错题",T60:"问答题",T61:"简答题",T62:"论述题",T63:"翻译题",T64:"计算题",T65:"作文题",T66:"案例题",T67:"材料题",T68:"推理题",T69:"名词解释",T80:"多题干共选项题",T8011:"单选题"}},RecogLibDataManage={clone:function(a){var b;if(a instanceof Array){b=[];var c=a.length;while(c--)b[c]=this.clone(a[c]);return b}else if(a instanceof Object){b={};for(var d in a)b[d]=this.clone(a[d]);return b}else return a},isEmptyOrNull:function(a){a=this.trim(a);return a==""||a==null?true:false},trim:function(a){return $.trim(a)},getLowerCase:function(a){return String.fromCharCode(97+a)},getUpperCase:function(a){return String.fromCharCode(65+a)},getRandom:function(){return((1+Math.random())*65536|0).toString(16).substring(1)},getGuid:function(){return this.getRandom()+this.getRandom()+"-"+this.getRandom()+"-"+this.getRandom()+"-"+this.getRandom()+"-"+this.getRandom()+this.getRandom()+this.getRandom()},timeOut:function(a,b){window.setTimeout(function(){a()},b)},baseData:{guidTeam:0,mark:0},jsonData:{},viewData:{},areaData:""},RecogLibSubject={recogBox:0,recogHigh:0,initElem:function(){this.recogBox=this.recogBox||$("#RecogBox");this.recogHigh=this.recogHigh||$("#RecogHigh")},clearRecog:function(a){this.recogBox[a==0?"show":"hide"]();this.recogHigh[a==1?"show":"hide"]()},tempRegion:0,getBtnState:function(){return'<span class="btn1">    <span style="background-color:#fff;">        <input type="button" value="开始识别" onclick="RecogLibSubject.exeRecogState();" />    </span></span> '},getBtnInsert:function(){return'<span class="btn1">    <span style="background-color:#fff;">        <input type="button" value="识别到试题中" onclick="RecogLibSubject.exeRecogInsert();" />    </span></span> '},getBtnBreak:function(){return'<span class="btn2">    <span style="background-color:#fff;">        <input type="button" value="返 回" onclick="RecogLibSubject.exeRecogBreak();" />    </span></span> '},getBtnClose:function(){return'<span class="btn2">    <span style="background-color:#fff;">        <input type="button" value="关 闭" onclick="RecogLibSubject.exeRecogClose();" />    </span></span> '},tempRegion:0,tempRegion:0,getRecogHead:function(a){return'<div class="recogBoxHead">'+a+"</div>"},getRecogHeadView:function(a){return'<div class="recogBoxHeadView">'+a+"</div>"},getRecogCont:function(a){return'<div class="recogBoxCont">'+a+"</div>"},getRecogContView:function(a){return'<div class="recogBoxContView">'+a+"</div>"},getRecogFoot:function(a){return'<div class="recogBoxFoot">'+a+"</div>"},tempRegion:0,tempRegion:0,getRecogHeadFore:function(){var a='<a class="recogBoxHeadSet z369Hover" href="javascript:void(0)" onclick="RecogLibHigh.showHigh();">高级设置</a><span class="recogBoxHeadSpan z369">请输入该题需识别的内容：</span>';return this.getRecogHead(a)},getRecogContFore:function(){var a='<textarea title="请输入该题需识别的内容"    ondblclick="this.select();"    onfocus="RecogLibSubject.focusin(this);"    onblur="RecogLibSubject.focusout(this);"    onchange="RecogLibSubject.exeAreaData(this.value);" >'+RecogLibDataManage.areaData+"</textarea>";return this.getRecogCont(a)},getRecogFootFore:function(){var a=this.getBtnState()+this.getBtnClose();return this.getRecogFoot(a)},tempRegion:0,tempRegion:0,getFontB:function(a){return'<span style="color:red;"><b>'+a+"</b></span>"},getViewCell:function(a,b){return'<div class="recogBoxContViewCell"><span>'+a+"：</span>"+b+"</div>"},getViewCellTitle:function(a,b){var c='<textarea style="height:60px;" '+b+'onchange="RecogLibSubject.exeViewTitleData(this.value);"  >'+(a.题干文本||"")+"</textarea>";return this.getViewCell("题 干",c)},getViewCellArea:function(g,d,a,b,c,e){var f='<textarea style="height:30px;" '+e+" onchange=\"RecogLibSubject.exeViewOptionsData('"+g+"','"+b+"','"+c+"',this.value);\" >"+d+"</textarea>";return this.getViewCell("选项"+a,f)},getViewCellInput:function(g,d,a,b,c,e){return"<label>"+a+".</label><input "+e+' value="'+d+'" onchange="RecogLibSubject.exeViewOptionsData(\''+g+"','"+b+"','"+c+"',this.value);\" />"},getRecogHeadAfter:function(){var f=RecogLibDataManage.jsonData,k=f.小题型Enum,b,g,e,i,n,m,j,h=RecogLibDataManage.viewData,c,l="A",d,a="";switch(k){case"11":case"12":b=RecogLibSetManage.option["T"+k];g=f.选项列表.length;e=b.min+"-"+b.max;c=h.选项列表.length;d=RecogLibDataManage.getUpperCase(c-1);break;case"14":b=RecogLibSetManage.option.T14;g=f.选项组.选项集合.length;e=b.min+"-"+b.max;c=h.选项组.选项集合.length;d=RecogLibDataManage.getUpperCase(c-1);break;case"15":i=RecogLibSetManage.space.T15;n=f.单选空格集合.length;m=i.min+"-"+i.max;j=h.单选空格集合.length;break;case"8011":b=RecogLibSetManage.option.T8011;g=f.选项集合.length;e=b.min+"-"+b.max;c=h.选项集合.length;d=RecogLibDataManage.getUpperCase(c-1)}switch(k){case"14":a+="当前选项"+this.getFontB(g)+"个;";a+="范围("+this.getFontB(e)+")个,";a+="已识别选项"+this.getFontB(c)+"个("+this.getFontB(l+"-"+d)+")";break;case"15":a+="当前空格"+this.getFontB(n)+"个;";a+="范围("+this.getFontB(m)+")个,";a+="已识别空格"+this.getFontB(j)+"个("+this.getFontB(1+"-"+j)+")";break;default:a+="当前选项"+this.getFontB(g)+"个;";a+="范围("+this.getFontB(e)+")个,";a+="已识别题干"+this.getFontB(RecogLibSetManage.currentHigh.isTitle?1:0)+"个;";a+="选项"+this.getFontB(c)+"个("+this.getFontB(l+"-"+d)+")"}return this.getRecogHeadView(a)},getRecogContAfter:function(){var f=RecogLibDataManage.viewData,h=RecogLibDataManage.baseData.mark,l=RecogLibSetManage.currentHigh,g='onfocus="RecogLibSubject.focusin(this);"onblur="RecogLibSubject.focusout(this);"',e="";switch(h){case"11":case"12":e+=l.isTitle?this.getViewCellTitle(f,g):"";for(var b=f.选项列表,c,d,a=0;a<b.length;a++){c=RecogLibDataManage.getUpperCase(a);d=b[a].选项内容文本;e+=this.getViewCellArea(h,d,c,null,a,g)}break;case"14":for(var b=f.选项组.选项集合,c,d,a=0;a<b.length;a++){c=RecogLibDataManage.getUpperCase(a);d=b[a].选项内容文本;e+=this.getViewCellArea(h,d,c,null,a,g)}break;case"15":for(var k=f.单选空格集合,b,c,d,j,i=0;i<k.length;i++){b=k[i].选项组.选项集合;j="";for(var a=0;a<b.length;a++){c=RecogLibDataManage.getUpperCase(a);d=b[a].选项内容文本;j+=this.getViewCellInput(h,d,c,i,a,g)}e+=this.getViewCell("序号"+(i+1),j)}break;case"8011":e+=l.isTitle?this.getViewCellTitle(f,g):"";for(var b=f.选项集合,c,d,a=0;a<b.length;a++){c=RecogLibDataManage.getUpperCase(a);d=b[a].选项内容文本;e+=this.getViewCellArea(h,d,c,null,a,g)}}return this.getRecogContView(e)},getRecogFootAfter:function(){var a=this.getBtnInsert()+this.getBtnBreak()+this.getBtnClose();return this.getRecogFoot(a)},tempRegion:0,tempRegion:0,exeRecogUpperCase:function(a){var b=RecogLibSetManage.chars.upperCase;a=a.replace(/\([A-Z]\)|\（[A-Z]\）|[A-Z]\)|[A-Z]\）|[A-Z] \)|[A-Z] \）|[A-Z]\.|[A-Z] \.|[A-Z]\．|[A-Z] \．|[A-Z]\、/g,b);a=a.replace(/[A-Z]\ |[A-Z]\　/g,b);return a},exeRecogLowerCase:function(a){var b=RecogLibSetManage.chars.lowerCase;a=a.replace(/\([a-z]\)|\（[a-z]\）|[a-z]\)|[a-z]\）|[a-z] \)|[a-z] \）|[a-z]\.|[a-z] \.|[a-z]\．|[a-z] \．|[a-z]\、/g,b);a=a.replace(/[a-z]\ |[a-z]\　/g,b);return a},exeRecogNumber:function(a){var b=RecogLibSetManage.chars.number;a=a.replace(/\(\d+\)|\（\d+\）|\d+\.|\d+ \.|\d+\．|\d+ \．|\d+\)|\d+\）|\d+ \)|\d+ \）/g,b);a=a.replace(/\d+\ |\d+\　/g,b);return a},clearRecogNumber:function(a){a=a.replace(/\(\d+\)|\（\d+\）|\d+\.|\d+ \.|\d+\．|\d+ \．|\d+\)|\d+\）|\d+ \)|\d+ \）/g,"");a=a.replace(/\d+\ |\d+\　/g,"");return a},exeRecogRegExp:function(c,a,b){return c.replace(a,b)},exeRecogChsNum:function(e){var f=RecogLibSetManage.currentHigh,b=f.number;if(b=="")return this.exeRecogNumber(e);else{var d=RecogLibSetManage.chars,g=d.special,a="",c;a+="\\d+";a+="\\"+b;a=a.replace(/&nbsp;/g," ");c=new RegExp(a,"g");return this.exeRecogRegExp(e,c,d.number)}},exeRecogOptions:function(g){var d=RecogLibSetManage.currentHigh,c=d.letterFore,b=d.letterAfter;if(c==""&&b=="")return this.exeRecogUpperCase(g);else{var f=RecogLibSetManage.chars,h=f.special,a="",e;a+=c!=""?"\\"+c:c;a+="[A-Z]";a+=b!=""?"\\"+b:b;a=a.replace(/&nbsp;/g," ");e=new RegExp(a,"g");return this.exeRecogRegExp(g,e,f.upperCase)}},exeSplitUpperCase:function(a){return a.split(RecogLibSetManage.chars.upperCase)},exeSplitNumber:function(a){return a.split(RecogLibSetManage.chars.number)},pushDataTitle:function(b){var a,d=RecogLibDataManage.viewData,e=RecogLibSetManage.currentHigh;if(e.isTitle){var c=b.indexOf(RecogLibSetManage.chars.upperCase);if(c!=-1){a=b.substring(0,c);a=this.clearRecogNumber(a);a=RecogLibDataManage.trim(a)}else a=b}else a="";d.题干文本=a},pushDataOptions:function(d){var b,c=[];switch(RecogLibDataManage.baseData.mark){case"11":case"12":for(var a=1;a<d.length;a++){b=RecogLibDataManage.trim(d[a]);RecogLibDataManage.isEmptyOrNull(b)||c.push({选项内容文本:b})}RecogLibDataManage.viewData.选项列表=c;break;case"14":for(var a=1;a<d.length;a++){b=RecogLibDataManage.trim(d[a]);RecogLibDataManage.isEmptyOrNull(b)||c.push({选项内容文本:b})}RecogLibDataManage.viewData.选项组={选项集合:c};break;case"15":for(var a=1;a<d.length;a++){if(a>=5)break;b=RecogLibDataManage.trim(d[a]);RecogLibDataManage.isEmptyOrNull(b)||c.push({选项内容文本:b})}c.length>=2&&RecogLibDataManage.viewData.单选空格集合.push({选项组:{选项集合:c}});break;case"8011":for(var a=1;a<d.length;a++){b=RecogLibDataManage.trim(d[a]);RecogLibDataManage.isEmptyOrNull(b)||c.push({选项内容文本:b})}RecogLibDataManage.viewData.选项集合=c}},pushDataNumber:function(c){switch(RecogLibDataManage.baseData.mark){case"15":var a;RecogLibDataManage.viewData.单选空格集合=[];for(var b=1;b<c.length;b++){a=this.exeRecogOptions(c[b]);a=this.exeSplitUpperCase(a);this.pushDataOptions(a)}}},exeCheckData:function(c){var d=RecogLibDataManage.viewData,i=RecogLibDataManage.baseData.mark;switch(i){case"11":var a=RecogLibSetManage.option.T11,f=d.选项列表,b=f.length;if(b<a.min||b>a.max){c({result:false,info:"单选题—选项范围为"+a.min+"-"+a.max+"个"});return}break;case"12":var a=RecogLibSetManage.option.T12,f=d.选项列表,b=f.length;if(b<a.min||b>a.max){c({result:false,info:"多选题—选项范围为"+a.min+"-"+a.max+"个"});return}break;case"14":var a=RecogLibSetManage.option.T14,f=d.选项组.选项集合,b=f.length;if(b<a.min||b>a.max){c({result:false,info:"选词填空—选项范围为"+a.min+"-"+a.max+"个"});return}break;case"15":var e=RecogLibSetManage.space.T15,h=d.单选空格集合,g=h.length;if(g<e.min||g>e.max){c({result:false,info:"完形填空—空格范围为"+e.min+"-"+e.max+"个"});return}break;case"8011":var a=RecogLibSetManage.option.T8011,f=d.选项集合,b=f.length;if(b<a.min||b>a.max){c({result:false,info:"多题干共选项子小题—选项范围为"+a.min+"-"+a.max+"个"});return}}c({result:true,info:""})},exeRecogState:function(){var a=RecogLibDataManage.areaData,b=RecogLibDataManage.baseData.mark,c=this;switch(b){case"15":a=this.exeRecogChsNum(a);a=this.exeSplitNumber(a);this.pushDataNumber(a);break;default:a=this.exeRecogOptions(a);this.pushDataTitle(a);a=this.exeSplitUpperCase(a);this.pushDataOptions(a)}this.exeCheckData(function(a){if(a.result)c.showRecogAfter();else RecogLibMsg.showMsg(a.info)})},exeRecogInsert:function(){var b=RecogLibDataManage.viewData,c=RecogLibSetManage.currentHigh,a=RecogLibDataManage.baseData;parent.Recog试题管理.pushData(a,b,c.isTitle);parent.IFrameSubjectRecogJson.closeRecogBox();RecogLibDataManage.areaData=""},exeRecogBreak:function(){RecogLibSubject.recogBox.html(this.getRecogForeHtml())},exeRecogClose:function(){parent.IFrameSubjectRecogJson.closeRecogBox()},tempRegion:0,getRecogForeHtml:function(){return this.getRecogHeadFore()+this.getRecogContFore()+this.getRecogFootFore()},getRecogAfterHtml:function(){return this.getRecogHeadAfter()+this.getRecogContAfter()+this.getRecogFootAfter()},showRecogFore:function(b,a){RecogLibDataManage.baseData.guidTeam=b;RecogLibDataManage.baseData.mark=a.小题型Enum;RecogLibDataManage.jsonData=a;this.clearRecog(0);RecogLibSubject.recogBox.html(this.getRecogForeHtml());RecogLibDataManage.timeOut(function(){RecogLibSubject.recogBox.find("textarea").focus()},100)},showRecogAfter:function(){RecogLibSubject.recogBox.html(this.getRecogAfterHtml())},exeAreaData:function(a){RecogLibDataManage.areaData=a},exeViewTitleData:function(a){RecogLibDataManage.viewData.题干文本=a},exeViewOptionsData:function(h,g,c,d){switch(h){case"11":case"12":for(var b=RecogLibDataManage.viewData.选项列表,a=0;a<b.length;a++)if(c==a){b[a].选项内容文本=d;break}break;case"14":for(var b=RecogLibDataManage.viewData.选项组.选项集合,a=0;a<b.length;a++)if(c==a){b[a].选项内容文本=d;break}break;case"15":for(var f=RecogLibDataManage.viewData.单选空格集合,b,e=0;e<f.length;e++)if(g==e){b=f[e].选项组.选项集合;for(var a=0;a<b.length;a++)if(c==a){b[a].选项内容文本=d;break}break}break;case"8011":for(var b=RecogLibDataManage.viewData.选项集合,a=0;a<b.length;a++)if(c==a){b[a].选项内容文本=d;break}}},focusin:function(a){a.style.backgroundColor="#eaf0f6"},focusout:function(a){a.style.backgroundColor="#fff"}},RecogLibHigh={getHighCell:function(a){return'<div class="recogHighContCell">    <span class="recogIcon"></span>'+a+"</div>"},getHighLetter:function(b){var d='type="text" class="recogHighContCellText" onfocus="RecogLibSubject.focusin(this);" onblur="RecogLibSubject.focusout(this);" ',c=b.letterFore,a=b.letterAfter,e="<span>选项分隔符：</span><input "+d+' maxlength="1" value="'+c+'"    onkeyup="RecogLibHigh.exeHighLetterFore(this.value)"    onchange="RecogLibHigh.exeHighLetterFore(this.value)" /><span id="TempLetterUpperCase_0" style="padding:0px 3px;" >(A)</span><input '+d+' maxlength="1" value="'+a+'"    onkeyup="RecogLibHigh.exeHighLetterAfter(this.value)"    onchange="RecogLibHigh.exeHighLetterAfter(this.value)" /><samp class="recogHighContCellFinish">值为:<span style="color:red;font-size:13px;" id="TempLetterFore">'+c+'</span><span style="color:green;" id="TempLetterUpperCase_1" >A</span><span style="color:red;font-size:13px;" id="TempLetterAfter">'+a+"</span></samp>";return this.getHighCell(e)},getHighNumber:function(a){var b='<span>序号分隔符：序号</span><input type="text" class="recogHighContCellText" maxlength="1" value="'+a.number+'"    onfocus="RecogLibSubject.focusin(this);"    onblur="RecogLibSubject.focusout(this);"     onkeyup="RecogLibHigh.exeHighNumber(this.value)"    onchange="RecogLibHigh.exeHighNumber(this.value)" /><samp class="recogHighContCellFinish">值为:<span style="color:green;" >序号</span><span style="color:red;font-size:13px;" id="TempLetterNumber">'+a.number+"</span></samp>";return this.getHighCell(b)},getHighTitle:function(a){var b='<label for="TempCheckBoxTitle">    <input id="TempCheckBoxTitle" onclick="RecogLibHigh.exeHighTitle(this.checked);" type="checkbox" '+(a.isTitle?'checked="checked" ':"")+' title="包含题干识别" />    包含题干识别</label>';return this.getHighCell(b)},getHighTrim:function(a){var b='<label for="TempCheckBoxTrim">    <input id="TempCheckBoxTrim" onclick="RecogLibHigh.exeHighTrim(this.checked);" type="checkbox" '+(a.isTrim?'checked="checked" ':"")+' title="自动清除空格" />    自动清除空格</label>';return this.getHighCell(b)},getHighUpperCase:function(a){var b='<label for="TempCheckBoxUpperCase">    <input id="TempCheckBoxUpperCase" onclick="RecogLibHigh.exeHighUpperCase(this.checked);" type="checkbox" '+(a.isUpperCase?'checked="checked" ':"")+' title="选项字母大写(A)" />    选项字母大写(A)</label>';return this.getHighCell(b)},getHighHead:function(){return'<div class="recogHighHead">    <b style="font-size:14px;" class="z369">高级设置</b></div>'},getHighCont:function(){var a='<div class="recogHighCont">',b=RecogLibSetManage.currentHigh;switch(RecogLibDataManage.baseData.mark){case"11":case"12":case"8011":a+=this.getHighLetter(b);a+=this.getHighTitle(b);break;case"14":a+=this.getHighLetter(b);break;case"15":a+=this.getHighNumber(b);a+=this.getHighLetter(b)}return a+="</div>"},getHighFoot:function(){return'<div class="recogHighFoot">    <span class="btn1">        <span style="background-color:#fff;">            <input type="button" value="恢复默认设置" onclick="RecogLibHigh.exeResertHigh();" />        </span>    </span>    <span class="btn1">        <span style="background-color:#fff;">            <input type="button" value="保存设置" onclick="RecogLibHigh.exeSaveHigh();" />        </span>    </span>    <span class="btn2">        <span style="background-color:#fff;">            <input type="button" value="取 消" onclick="RecogLibHigh.exeCloseHigh();" />        </span>    </span></div>'},getHighHtml:function(){return'<div class="recogHighBox">'+this.getHighHead()+this.getHighCont()+this.getHighFoot()+"</div>"},showHigh:function(){RecogLibSubject.clearRecog(1);RecogLibSubject.recogHigh.html(this.getHighHtml())},exeHighLetterFore:function(a){RecogLibSetManage.tempHigh.letterFore=a;$("#TempLetterFore").text(a)},exeHighLetterAfter:function(a){RecogLibSetManage.tempHigh.letterAfter=a;$("#TempLetterAfter").text(a)},exeHighNumber:function(a){RecogLibSetManage.tempHigh.number=a;$("#TempLetterNumber").text(a)},exeHighTitle:function(a){RecogLibSetManage.tempHigh.isTitle=a},exeHighTrim:function(a){RecogLibSetManage.tempHigh.isTrim=a},exeHighUpperCase:function(a){RecogLibSetManage.tempHigh.isUpperCase=a;$("#TempLetterUpperCase_0").text("("+(a?"A":"a")+")");$("#TempLetterUpperCase_1").text(a?"A":"a")},exeResertHigh:function(){if(window.confirm("确定恢复默认设置吗?")){RecogLibSetManage.currentHigh=RecogLibDataManage.clone(RecogLibSetManage.normalHigh);RecogLibSetManage.tempHigh=RecogLibDataManage.clone(RecogLibSetManage.normalHigh);RecogLibSubject.clearRecog(0)}},exeSaveHigh:function(){RecogLibSetManage.currentHigh=RecogLibDataManage.clone(RecogLibSetManage.tempHigh);RecogLibSubject.clearRecog(0)},exeCloseHigh:function(){RecogLibSetManage.tempHigh=RecogLibDataManage.clone(RecogLibSetManage.currentHigh);RecogLibSubject.clearRecog(0)}},RecogLibMsg={msgBox:0,initMsg:function(){this.msgBox=this.msgBox||new MsgBox("",{isAutoHide:true,timeOut:2500,bgColor:"#ffffcd"})},setMsgCont:function(a){a='<div style="padding:5px;">'+a+"</div>";this.msgBox.setContent(a)},setMsgSite:function(){this.msgBox.moveElem({left:180,top:100})},showMsg:function(a){this.initMsg();this.setMsgCont(a);this.setMsgSite();this.msgBox.setIndex(1e6);this.msgBox.show()}}