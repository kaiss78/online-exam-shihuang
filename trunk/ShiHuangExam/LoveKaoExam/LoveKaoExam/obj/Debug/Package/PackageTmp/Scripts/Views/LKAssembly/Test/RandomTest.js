$(document).ready(function(){RandomLoadPage.ready()});var RandomLoadPage={ready:function(){SortManage.initSort()}},RandomTestDataManage={sort:{min:1,max:10,maxSubType:14},randomData:{分类列表:[],创建人ID:"00000000-0000-0000-0000-000000000000",题型集合:[{题型Enum:"11",数量:0,每小题分值:0,题型名称:"单选题"},{题型Enum:"12",数量:0,每小题分值:0,题型名称:"多选题"},{题型Enum:"13",数量:0,每小题分值:"0",题型名称:"填空题"}]},names:{T10:"自由题",T11:"单选题",T12:"多选题",T13:"填空题",T14:"选词填空",T15:"完形填空",T20:"判断题",T30:"连线题",T40:"复合题",T41:"诗词鉴赏",T42:"阅读理解",T43:"快速阅读",T44:"文言文",T45:"现代文",T46:"材料分析",T47:"案例分析",T50:"改错题",T60:"问答题",T61:"简答题",T62:"论述题",T63:"翻译题",T64:"计算题",T65:"作文题",T66:"案例题",T67:"材料题",T68:"推理题",T69:"名词解释",T80:"多题干共用选项题"},AddCreatePeo:function(a){this.randomData.创建人ID=a},jsonToText:function(a){return JSON.jsonToText(a)},edit及格条件:function(b){var a=b;this.randomData.及格条件=a},get分类列表:function(){return this.randomData.分类列表},getSubType:function(b){return this.randomData.题型集合[b]},getSubTypeCount:function(b){return this.getSubType(b).数量},getSubTypeValue:function(b){return this.getSubType(b).每小题分值},editSubTypeName:function(d,b){var a=this.getSubType(d),c=RandomTestDataManage.names["T"+b];a.题型Enum=b;a.题型名称=c},editSubTypeCount:function(c,b){var a=this.getSubType(c);a.数量=b},editSubTypeValue:function(b,c){var a=this.getSubType(b);a.每小题分值=c},trim:function(a){return $.trim(a)},interceptString:function(b,a){a=a||10;return b.length>a?a==10?b.substring(0,a):b.substring(0,a)+"...":b},onkeyup:function(a){if(event.keyCode==9)return;a.value=a.value.replace(/[^\d.]/g,"");a.value=a.value.replace(/^\./g,"");a.value=a.value.replace(/\.{2,}/g,".");a.value=a.value.replace(".","$#$").replace(/\./g,"").replace("$#$",".")},onkeyup1:function(a){if(event.keyCode==9)return;a.value=a.value.replace(/[^\d.]/g,"");a.value=a.value.replace(/^\./g,"");a.value=a.value.replace(/\.{2,}/g,"");a.value=a.value.replace("","$#$").replace(/\./g,"").replace("$#$","")},onFous:function(b){var a=$(b);a.select();a.addClass("inputColor")},refreshTest:function(){window.location.reload()},getOffset:function(c){var a=$(c),d=a.offset().top,b=a.offset().left;return{top:d,left:b}}},BoxyManage={testGuid:0,showNoMakeMsg:function(a){this.testGuid=a;Boxy.confirm('<div class="ExamMsgBox"><div class="ExamMsgHeader"></div><div class="ExamMsgFooter" style="height:auto;line-height:25px;float:left;">由于您填写的相关题型数量为0或者多于系统的试题数量,您是否继续提交?</div></div>',function(){AjaxRandomManange.isSubmit=true;AjaxRandomManange.isSubmit&&MsgInforManage.hrefCreateExam(BoxyManage.testGuid)},{title:"提醒",modal:true})}},SortManage={initBox:function(){$("#RandomTestSortID").tags({source:GlobalManage.clone(RandomTestDataManage.randomData.分类列表),inp_width:330,change:function(a){RandomTestDataManage.randomData.分类列表=GlobalManage.clone(a)}})},initSort:function(){this.initBox()}},MsgInforManage={isClose:false,referExamBox:0,referDiv:0,InitReferExam:function(){this.referExamBox=this.referExamBox||new Boxy('<div class="referBox" id="referBoxId"></div>',{title:"生成试卷",modal:true,show:0,closeText:"[关闭]",afterHide:function(){AjaxRandomManange.isRefersh&&RandomTestDataManage.refreshTest()}});this.referDiv=this.referDiv||$("#referBoxId")},showReferBox:function(){this.InitReferExam();this.referExamBox.show()},hideReferBox:function(){this.referExamBox.hide()},getReferHead:function(a){switch(a){case"success":return"生成试卷保存成功，你可以继续执行以下操作:";break;case"fail":return"生成试卷失败，你可以检查一下失败信息:";break;case"failSort":return"分类范围填写错误，你可以检查一下错误分类的信息:";break;case"error":return"生成试卷错误，你可以检查一下错误信息:";break;default:return""}},getReferContent:function(b,a){switch(b){case"checkWait":return"";break;case"unFinish":return a;break;case"referLink":return a}},setReferBox:function(c,b,d){var a='<div class="referHeader">'+this.getReferHead(c)+'</div><div class="referInfor">'+this.getReferContent(b,d)+"</div>";this.showReferBox();this.referDiv.html(a)},isRandomSortHtml:function(b,a){return'<div class="isSortDiv"><span class="isSortIndex">'+(b+1)+'.</span><span class="isSortFont">'+a+"</span></div>"},setIsSort:function(c){for(var e=RandomTestDataManage.randomData.分类列表,f=e.length,d="",a=0;a<c.length;a++)for(var b=0;b<f;b++)if(c[a].分类名==e[b]){d+=this.isRandomSortHtml(b,c[a].分类名);break}return d+'<div class="isSortDiv reSort">以上所填写的分类不存在,请<a href="javascript:void(0)" onclick="MsgInforManage.hideReferBox();">重新填写</a></div>'},setIsSubCount:function(a){var c=a.序号,b=a.题型名称;sortHtml="";sortHtml+=this.isRandomSortHtml(k,listSort[i].分类名)},hrefCreateExam:function(a){window.location.href=""+LKConfig.URLAssembly.Test.Page.get("EditExam")+"?guid="+a+"&type=2"}},AddSubTypeManage={subTypeBox:0,getSubTypeBoxHtml:function(){return'<div class="SubTypeChooseBox"><div class="TestSetBoxContent" style="color:#666;font-size:15px; ">                    <div class="TestSetBoxLeft" style=" font-weight:bold;">第二步：</div>                    <div class="TestSetBoxRight " style=" line-height:58px;width:400px;">                    请选择题型范围 <a href="javascript:void(0)" class="commonIco changeSubTypeName" hidefocus="true" onclick="AddSubTypeManage.addSubType();">添加题型范围</a>                    </div>                </div>                 <div class="TestSetBoxContent" id="AddSubTypeID">                </div>                <div class="TestSetBoxContent" style="width:785px; font-size:12px;  padding-top:30px;">                   <a  class="commonIco changeSubTypeName" href="javascript:void(0)" onclick="AjaxRandomManange.ajaxRandom();" hidefocus="true"  >随机生成试卷</a>                   <div id="createTesting" class="commonIco changeSubTypeName" style="padding-left:6px;display:none; margin-right:9px;color:#369;" >正在生成试卷...</div>                   <a  class="commonIco changeSubTypeName nextIcon" title="返回上一步可以重新选择分类范围" href="javascript:void(0)" onclick="RandomNextManage.hideSubTypeBox();"  hidefocus="true"  >返回上一步</a>                </div></div>'},getSubTypeHtml:function(a){var b=RandomTestDataManage.getSubType(a),e=b.题型Enum,f=RandomTestDataManage.names["T"+e],c=b.数量,d=b.每小题分值;return'<div class="subTypeSort" onmousemove="AddSubTypeManage.moveSubType(this);" onmouseout="AddSubTypeManage.moveoutSubType(this);"><div class="subTypeIndex">'+(a+1)+'.</div>        <div class="subTypeDiv subNameDiv">           <span class="subTypeFont">题型名称：</span>           <a href="javascript:void(0)" hideFocus="True" onclick="RandomIframSubTypeManage.show(this,\''+a+'\')" class="subTypeFontDiv"><span class="subTypeFontSpan">'+f+'</span></a>        </div>        <div class="subTypeDiv subCountDiv">            <span class="subCountFont"  style=" padding-left:25px;">题型数量：</span>            <input class="subTypeInput" onfocus="RandomTestDataManage.onFous(this);" maxlength="3" onblur="AddSubTypeManage.changeCount(this,\''+a+'\')"  onkeyup="RandomTestDataManage.onkeyup1(this)"  value="'+c+'" />        </div>        <div class="subTypeDiv">            <span class="subValuesFont">每小题分值：</span>            <input class="subTypeInput" onfocus="RandomTestDataManage.onFous(this);" maxlength="4" onblur="AddSubTypeManage.changeValue(this,\''+a+'\')" onkeyup="RandomTestDataManage.onkeyup(this)" value="'+d+'" />        </div>        <div   title="删除该题型" onclick="AddSubTypeManage.delSubType(\''+a+"');\"></div>     </div>"},moveSubType:function(d){var a=$(d);a.addClass("subTypeMove");var b=RandomTestDataManage.randomData.题型集合,c=b.length;if(c==RandomTestDataManage.sort.min)return;a.children("div:eq(4)").addClass("subTypeDel")},moveoutSubType:function(b){var a=$(b);a.removeClass("subTypeMove");a.children("div:eq(4)").removeClass("subTypeDel")},initSubTypeBox:function(){var a=RandomTestDataManage.randomData.题型集合,b=a.length;this.setSubType(b)},addSubType:function(){var a=RandomTestDataManage.randomData.题型集合,b=a.length;if(b>RandomTestDataManage.sort.maxSubType)return;a.push({题型Enum:"11",数量:"0",每小题分值:"0",题型名称:"单选题"});this.subTypeBox.append(this.getSubTypeHtml(b))},setSubType:function(b){this.subTypeBox.html("");for(var a=0;a<b;a++)this.subTypeBox.append(this.getSubTypeHtml(a))},delSubType:function(d){var c=RandomTestDataManage.randomData.题型集合,a=c.length;if(a==RandomTestDataManage.sort.min)return;for(var b=0;b<a;b++)if(b==d){c.splice(b,1);a--;break}this.setSubType(a)},changeSubTypeName:function(b){var a=$(b);a.addClass("subTypeLink")},changeCount:function(b,d){var e=$(b),a=e.val(),c=RandomTestDataManage.getSubTypeCount(d);e.removeClass("inputColor");if(a<0||a>100){alert("试题数量设置的范围0-100之间，请重新填写");b.value=c;a=c;RandomTestDataManage.onFous(b)}RandomTestDataManage.editSubTypeCount(d,a)},changeValue:function(b,d){var e=$(b),a=e.val(),c=RandomTestDataManage.getSubTypeValue(d);a=Math.round(a*10)/10;a=parseFloat(a);e.removeClass("inputColor");if(a<0||a>99.9){alert("每小题分值的范围0-99.9,请重新填写分值!");b.value=c;a=c;RandomTestDataManage.onFous(b)}RandomTestDataManage.editSubTypeValue(d,a)}},RandomIframSubTypeManage={msgBox:0,subTypeBoxID:0,chs:0,iFrameElem:0,_subTypeObj:0,initMsgBox:function(c,a){var b=this;this._subTypeObj=c;this.msgBox=this.msgBox||new MsgBox("<iframe onload=\"RandomIframSubTypeManage.loadMsgBox(this,'"+a+'\');" frameborder="0" scrolling="no"  width="383px" height="160px"></iframe>',{isTipMsg:false,isAutoHide:true,show:false,afterHide:function(){b.afterHide()}}).set内部对象属性("iframe","src",LKConfig.URLAssembly.Subject.IFrame.get("QuestionTypes"))},loadMsgBox:function(c,a){var b=this._subTypeObj;this.iFrameElem=c.contentWindow.QuestionTypesManage;this.send(b,a)},clickOver:function(a){$(a).addClass("subTypeLink")},clickOut:function(){this.chs.removeClass("subTypeLink")},setSite:function(b){var a=RandomTestDataManage.getOffset(b);a.left;a.top+=25;this.msgBox.moveElem(a)},show:function(a,b){this.clickOver(a);this.initMsgBox(a,b);this.setSite(a);this.msgBox.show();this.send(a,b)},afterHide:function(){this.clickOut()},minMsgBox:function(){this.msgBox.hide()},send:function(d,c){var a=this,b=c;this.iFrameElem&&this.iFrameElem.receive(function(c){a.receive(d,b,c)},function(){a.minMsgBox()})},receive:function(b,c,a){this.setMark(b,a);this.setName(b,a);RandomTestDataManage.editSubTypeName(c,a)},setMark:function(b,a){$(b).attr("mark",a)},setName:function(c,b){var a=RandomTestDataManage.names["T"+b];$(c).children("span").text(a)}},RandomNextManage={testSetBoxID:0,isAddSubTypeBox:false,hideSortBox:function(){this.testSetBoxID=this.testSetBoxID||$("#TestSetBoxID");this.testSetBoxID.children("div:eq(0)").hide();if(!this.isAddSubTypeBox){this.testSetBoxID.append(AddSubTypeManage.getSubTypeBoxHtml());this.isAddSubTypeBox=true;AddSubTypeManage.subTypeBox=$("#AddSubTypeID");AddSubTypeManage.initSubTypeBox()}else this.testSetBoxID.children("div:eq(1)").show();RandomIframSubTypeManage.chs=AddSubTypeManage.subTypeBox.find("a")},hideSubTypeBox:function(){this.testSetBoxID.children("div:eq(0)").show();this.testSetBoxID.children("div:eq(1)").hide()}},AjaxRandomManange={sort:[],isSubmit:false,isRefersh:false,createTestID:0,_testJson:0,_randomJson:{网站分类集合:"",取题题型及数量集合:[]},ajaxIsSort:function(){this._testJson=RandomTestDataManage.randomData;var a=this._randomJson,c=this._testJson;a.网站分类集合=this._testJson.分类列表;this.sort=[];for(var b=0;b<c.分类列表.length;b++)c.分类列表[b]!=""&&this.sort.push(c.分类列表[b]);this._randomJson.网站分类集合=null;a.网站分类集合=this.sort.join(",");if(a.网站分类集合==""){MsgInforManage.setReferBox("failSort","unFinish","请填写分类范围,谢谢！！");return}$.ajax({type:"POST",url:LKConfig.URLAssembly.Test.Server.get("IsSort"),data:{randomSort:a.网站分类集合},dataType:"json",success:function(a){if(a.result)RandomNextManage.hideSortBox();else MsgInforManage.setReferBox("failSort","unFinish",MsgInforManage.setIsSort(a.info))},error:function(c,a){MsgInforManage.setReferBox("fail","error",a)}})},ajaxRandom:function(){for(var b=this._randomJson,d=[],c=RandomTestDataManage.randomData.题型集合,a=0;a<c.length;a++)c[a].数量==0&&d.push({序号:a,名称:+c[a].题型名称});b.取题题型及数量集合=c;b=RandomTestDataManage.jsonToText(b);this.createTestID=this.createTestID||$("#createTesting");this.createTestID.prev().hide();this.createTestID.show();$.ajax({type:"POST",url:LKConfig.URLAssembly.Test.Server.get("RandomTest"),data:{randomDataJson:b},dataType:"json",success:function(a){AjaxRandomManange.createTestID.hide();AjaxRandomManange.createTestID.prev().show();switch(a.outInfo){case 1:if(d.length==0)MsgInforManage.hrefCreateExam(a.info);else BoxyManage.showNoMakeMsg(a.info);break;case 2:BoxyManage.showNoMakeMsg(a.info);break;default:MsgInforManage.setReferBox("fail","unFinish",a.info)}},error:function(c,a){AjaxRandomManange.createTestID.prev().show();AjaxRandomManange.createTestID.hide();MsgInforManage.setReferBox("fail","error",a)}})}}