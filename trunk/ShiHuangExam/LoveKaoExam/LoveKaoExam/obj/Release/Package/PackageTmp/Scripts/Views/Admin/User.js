var AdminUser={EditSame:{ElemAssembly:{Post:{角色:0,编号:0,姓名:0,性别:0,邮箱:0,部门ID:0},Other:{Item_邮箱:0,Item_部门ID:0,编号考官:0,编号考生:0,提交按钮:0}},initData:function(c,b){this.DataAssembly.Backup.角色=c;this.DataAssembly.Post.ID=b;if(b!=Global.Guid.empty())this.DataAssembly.Backup.操作类型="本地修改";else this.DataAssembly.Backup.操作类型="本地添加";var a=this.ElemAssembly;Global.LoadIng.ready(function(){var b=$("#编号"),c=$("#提交按钮");a.Post.角色=$("input[type='radio'][name='角色']");a.Post.性别=$("input[type='radio'][name='性别']");a.Post.编号=b;a.Post.姓名=$("#姓名");a.Post.邮箱=$("#邮箱");a.Post.部门ID=$("#部门ID");a.Other.Item_邮箱=$("#Item_邮箱");a.Other.Item_部门ID=$("#Item_部门ID");a.Other.编号考生=$("#编号考生");a.Other.编号考官=$("#编号考官");a.Other.提交按钮=c;Global.Object.Tag.inputFE(b);Global.AccessKey.KeyDown.enter(function(){Global.Object.Tag.onClick(提交按钮)})})},tabIdentity:function(a){this.DataAssembly.Backup.角色=a;this.ElemAssembly.Other.Item_邮箱.css("display",a==1?"block":"none");this.ElemAssembly.Other.Item_部门ID.css("display",a==0?"block":"none");this.ElemAssembly.Other.编号考生.css("display",a==0?"inline-block":"none");this.ElemAssembly.Other.编号考官.css("display",a==1?"inline-block":"none");this.ElemAssembly.Post.编号.focus()},Handle:{Type:{本地添加:"本地添加",本地修改:"本地修改"},name:function(){return AdminUser.EditSame.DataAssembly.Backup.操作类型=="本地修改"?"修改":"创建"},embedBoxyHide:function(){parent&&parent.AdminiEmbedHandle&&parent.AdminiEmbedHandle.User.Boxy.hide()},embedBoxyBtn:function(a){switch(AdminUser.EditSame.DataAssembly.Backup.操作类型){case"本地修改":parent&&parent.AdminiEmbedHandle&&parent.AdminiEmbedHandle.User.Boxy.setCloseVis(a)}},completed:function(){switch(AdminUser.EditSame.DataAssembly.Backup.操作类型){case"本地添加":AdminUser.EditSame.ElemAssembly.Post.编号.val("").focus();AdminUser.EditSame.ElemAssembly.Post.姓名.val("");AdminUser.EditSame.ElemAssembly.Post.邮箱.val("");break;case"本地修改":parent&&parent.AdminiEmbedHandle&&parent.AdminiEmbedHandle.User.Update.list({waitType:"正在更新"})}}},Format:{角色:function(b){var a=AdminUser.EditSame.ElemAssembly.Post.角色;if(a.eq(0).attr("checked")==false&&a.eq(1).attr("checked")==false){Global.Object.Tag.onFocus(a.eq(0));Global.CallBack.false_3(b,"请选择用户类型！",a)}else Global.CallBack.true_1(b,a.eq(0).attr("checked")?0:1)},编号:function(c){var a=AdminUser.EditSame.ElemAssembly.Post.编号,b=a.val().trim(),d=/^[a-zA-Z0-9]{4,16}$/;if(b==""){Global.Object.Tag.onFocus(a);Global.CallBack.false_3(c,"请输入帐号！",a)}else if(!d.exec(b)){Global.Object.Tag.onFocus(a);Global.CallBack.false_3(c,"帐号只允许使用4到16位字符的英文、数字组合！",a)}else Global.CallBack.true_1(c,b)},姓名:function(c){var a=AdminUser.EditSame.ElemAssembly.Post.姓名,b=a.val().trim(),e=/^[\u4e00-\u9fa5]{2,4}$/,d=/^[A-Za-z]{2,8}$/;if(!(d.test(b)||e.test(b))){Global.Object.Tag.onFocus(a);Global.CallBack.false_3(c,"姓名只允许使用2到8位是中文或英文！",a)}else Global.CallBack.true_1(c,b)},邮箱:function(c){var a=AdminUser.EditSame.ElemAssembly.Post.邮箱,b=a.val().trim();Global.Format.email(b,null,true,a,c)},部门ID:function(d){var a=AdminUser.EditSame.ElemAssembly.Post.部门ID,b=a.find("option:selected"),c=b.val().trim();if(Global.String.isNullOrEmpty(c)){Global.Object.Tag.onFocus(a);Global.CallBack.false_3(d,b.text().replace(/-/g,"")+"！",a)}else Global.CallBack.true_1(d,c)},性别:function(b){var a=AdminUser.EditSame.ElemAssembly.Post.性别;if(a.eq(0).attr("checked")==false&&a.eq(1).attr("checked")==false){Global.Object.Tag.onFocus(a.eq(0));Global.CallBack.false_3(b,"请选择性别！",a)}else Global.CallBack.true_1(b,a.eq(0).attr("checked")?1:2)}},DataAssembly:{Post:{ID:null,角色:0,编号:"",姓名:"",性别:"",邮箱:"",部门ID:""},Backup:{角色:0,操作类型:""}},postAjax:function(b){var c="Admin-User",e=Global.Boxy.Topics.Admin.user(b.角色,b.编号),d=AdminUser.EditSame.Handle,a=d.name();AdminUser.EditSame.Handle.embedBoxyBtn(false);Global.Boxy.wait(c,{newTitle:a,dtHtml:a+e,triggerBtn:AdminUser.EditSame.ElemAssembly.Other.提交按钮});Global.AjaxServer.Post.json("/User/UCEditor/",b,function(b){if(b.result)Global.Boxy.success(c,{newTitle:a+"成功",dtHtml:e+"已"+a+"成功.",boxyOptions:{beforeHide:function(){d.embedBoxyHide()},afterHide:function(){d.completed()}}});else{AdminUser.EditSame.Handle.embedBoxyBtn(true);Global.Boxy.failure(c,{newTitle:a+"失败",dtHtml:e+a+"失败",newMessage:b.info})}})},submit:function(){var a=AdminUser.EditSame.DataAssembly.Backup.角色,b=a==0?["编号","姓名","部门ID","性别"]:["编号","姓名","邮箱","性别"];AdminUser.EditSame.DataAssembly.Post.角色=a;Global.MsgBox.submit(this,b)}},ImExport:{initData:function(){var a=this.ElemAssembly;Global.LoadIng.ready(function(){a.Post.导入考生XLSPath=$("#导入考生XLSPath");a.Other.Admin_User_Import=$("#Admin_User_Import");a.Other.Admin_User_Export=$("#Admin_User_Export");a.Other.提交按钮=$("#提交按钮")})},ElemAssembly:{Post:{导入考生XLSPath:0},Other:{Admin_User_Import:0,Admin_User_Export:0,提交按钮:0}},DataAssembly:{Post:{导入考生XLSPath:""},Backup:{已存在编号数组:[]}},tabIdentity:function(b){var a=this.ElemAssembly;a.Other.Admin_User_Import.css("display",b==0?"block":"none");a.Other.Admin_User_Export.css("display",b==1?"block":"none")},Format:{导入考生XLSPath:function(c){var a=AdminUser.ImExport.ElemAssembly.Post.导入考生XLSPath,b=Global.Extension.fileUpload(a[0]);if(b==""){Global.Object.Tag.onFocus(a);Global.CallBack.false_3(c,"请选择您要导入的"+Global.Environment.get考生名称()+"Excel！",a)}else Global.Extension.isExcel(b,function(d){if(d.result)Global.CallBack.true_1(c,b);else Global.CallBack.false_3(c,d.info,a)})}},view重复编号:function(){var a=AdminUser.ImExport.DataAssembly.Backup.已存在编号数组||[],c="Admin-ImExport",b=Global.Environment.get考生名称()+"的"+Global.Environment.get考生编号();Global.Boxy.alert(c,{newTitle:b,dtHtml:"已存在"+b+"共"+a.length+"个",dtStyle:"padding:10px 0 15px 0;",ddScrollBar:true,newMessage:a})},postAjax:function(){var b="Admin-ImExport",c=Global.Environment.get考生名称()+"信息",a="导入";Global.Boxy.wait(b,{newTitle:a,dtHtml:a+c,triggerBtn:AdminUser.ImExport.ElemAssembly.Other.提交按钮});$("#FormUpload").ajaxSubmit({target:null,beforeSubmit:null,dataType:"json",resetForm:true,success:function(d){if(d.result){var i=d.info||{},e=i.已存在编号数组||[],f=e.length,j=Global.Environment.get考生名称(),k=Global.Environment.get考生编号(),h=Global.HTML.a("查看",{onclick:"AdminUser.ImExport.view重复编号();"}),g=f==0?"":"导入"+j+"信息中有"+f+"个"+k+"已存在 "+h;AdminUser.ImExport.DataAssembly.Backup.已存在编号数组=e;Global.Boxy.success(b,{newTitle:a+"成功",dtHtml:c+"已"+a+"成功.",dtStyle:"padding:11px 0px 20px 0px;",newMessage:g,boxyOptions:{beforeHide:function(){}}})}else{AdminUser.EditSame.Handle.embedBoxyBtn(true);Global.Boxy.failure(b,{newTitle:a+"失败",dtHtml:c+a+"失败",dtStyle:"padding:11px 0px 20px 0px;",newMessage:d.info})}}})},submit:function(){Global.MsgBox.submit(this,["导入考生XLSPath"])}}}