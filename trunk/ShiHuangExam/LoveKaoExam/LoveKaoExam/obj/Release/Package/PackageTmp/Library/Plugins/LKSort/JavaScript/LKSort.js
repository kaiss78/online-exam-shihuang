$.fn.extend({lksort:function(a){return this.each(function(){new LKSort(this,a)})}});function LKSort(b,a){this.ordNum=0;this.data={};this.stData={};this.E_LKsort=jQuery(LKSort.WRAPPER);this.options=jQuery.extend({},LKSort.DEFAULTS,a||{});this.init_head();this.init_cell();this.set_width();this.E_LKsort.appendTo(b)}LKSort.EF=function(){};LKSortManage={getRandom:function(){return((1+Math.random())*65536|0).toString(16).substring(1)},getGuid:function(){return this.getRandom()+this.getRandom()+"-"+this.getRandom()+"-"+this.getRandom()+"-"+this.getRandom()+"-"+this.getRandom()+this.getRandom()+this.getRandom()},getOffset:function(c){var a=$(c),d=a.offset().top,b=a.offset().left;return{top:d,left:b}},tipMsg_box:0,tipMsg_site:function(a){this.tipMsg_box.moveElem(a.site||{top:0,left:0})},tipMsg_cont:function(b){var a=b.cont||"<br />";a='<div style="padding:5px;color:#444;font-size:13px;line-height:1.5em;">'+a+"</div>";this.tipMsg_box.setContent(a)},tipMsg_init:function(){this.tipMsg_box=this.tipMsg_box||new MsgBox("",{isTipMsg:false,isAutoHide:true,bgColor:"#ffffcd",timeOut:0,innerStyle:""})},tipMsg_show:function(){this.tipMsg_box.show()},tipMsg_hide:function(){this.tipMsg_box.hide()},tipMsg:function(a){this.tipMsg_init();this.tipMsg_cont(a);this.tipMsg_site(a);this.tipMsg_show()}};$.extend(LKSort,{WRAPPER:'<div class="fl-box">    <div class="fl-head">       <span class="fl-zu">分类组</span>    </div>    <div class="fl-list">    </div></div>',DEFAULTS:{maxNum:10,minNum:1,norNum:2,norList:[{分类名:"",类型:""},{分类名:"",类型:""}],inp_width:220,inp_maxLen:20,isAdd:true,isHistory:true,isHelp:true,auto_maxNum:8,auto_seaNum:50,auto_scrollHeight:180,auto_cacheLength:100,norSTList:["","","","",""],afterUpdate:LKSort.EF}});LKSort.prototype={get_elem_head:function(){return this.E_LKsort.children("div.fl-head")},get_elem_list:function(){return this.E_LKsort.children("div.fl-list")},get_elem_cell:function(){return this.get_elem_list().children("div.fl-cell")},set_width:function(){var b=this.options,a=b.inp_width;a>0&&this.E_LKsort.width(a+140)},get_ordNum:function(a){return GlobalManage.trim(a.children("label.fl-num").attr("ordNum"))},get_cur_st:function(){var g=this.data,b={},h=this.options,d=h.norSTList,a,e,f="";for(var i in g)b[g[i].类型]=true;for(var c=0;c<d.length;c++){a=d[c];e=a.length>2?a.substring(0,2):a;if(!b[a]&&!b[e]){f=a;break}}return f||""},save_data:function(a,b,c){this.data[a]={分类名:b,类型:c||""}},clear_list:function(){this.get_elem_list().html("")},init_head:function(){var a=this.options,b=this.get_elem_head(),f=a.isAdd,d=a.isHistory,e=a.isHelp,g="",c=this;a.isAdd&&$('<a class="fl-add" title="点击新增一个分类(最多为'+a.maxNum+'个)">新增分类</a>').click(function(){c.add_cell("","")}).appendTo(b);a.isHistory&&$('<a class="fl-his" title="点击查看最近使用分类">最近使用分类</a>').click(function(){c.show_FLZJSY()}).appendTo(b);a.isHelp&&$('<a class="fl-help" title="点击查看分类帮助">帮助？</a>').click(function(){c.tip_help()}).appendTo(b)},tip_overNum:function(){var b=this.E_LKsort,a=LKSortManage.getOffset(b),c=this.options;a.left+=150;a.top-=40;LKSortManage.tipMsg({cont:'分类个数不能多于<b style="color:#f50;">'+c.maxNum+"</b>个",site:a})},tip_help:function(){var b=this.E_LKsort,a=LKSortManage.getOffset(b),c=this.options;a.left+=b.width()-60;a.top-=78;LKSortManage.tipMsg({cont:'例：若您录入的试题或试卷是"2010年浙江高考语文"<br/>则您的分类可以填写为"2010"，"浙江"，"高考语文"。<br/>分类填写的越精准，则试题或试卷的价值越高。',site:a})},add_cell:function(d,a){var c="",g=this.options,e=this.ordNum,h=g.inp_width,a,j=this.get_elem_list(),i=LKSortManage.getGuid();if(e>=g.maxNum){this.tip_overNum();return}if(d!="")a=a?a:"";else a=a?a:this.get_cur_st();c+='<div class="fl-cell" style="*float:left;*width:100%;">';c+='<label class="fl-num" ordNum="'+e+'">'+(e+1)+".</label>";c+='<label for="input_'+i+'" class="fl-stype '+(d!=""?"hidden":"")+'" >'+(a?a:"")+"</label>";c+='<input class="fl-sname" id="input_'+i+'" style="'+(h>0?"width:"+h+"px":"")+'" type="text" maxlength="'+g.inp_maxLen+'" value="'+d+'" />';c+='<a class="fl-del" href="javascript:void(0)" title="删除该分类"></a>';c+='<span class="fl-stype">'+(a!=""&&d!=""?"["+a+"]":"")+"</span>";c+="</div>";var f=this,b=$(c);this.init_input(b);b.hover(function(){f.mouse_cell(b,"mouse-over")},function(){f.mouse_cell(b,"mouse-out")});b.children("a.fl-del").click(function(){f.del_cell(b,f.get_ordNum(b))});b.appendTo(j);this.save_data(e,d,a);this.ordNum++},del_cell:function(f,h){var i=this.data,c={},d=this.ordNum,a=0,e=this.get_elem_cell(),g=this.options;if(d<=g.minNum)return;for(var b=0;b<d;b++)if(b!=h){c[a]=i[b];e.eq(b).children("label.fl-num").attr("ordNum",a+"").text(a+1+".");a++}this.ordNum=a;this.data=c;f.remove();this.update_cell_st();this.after_Update()},update_cell:function(){var d=this.data,c,a,b;this.clear_list();this.ordNum=0;this.data={};for(var e in d){c=d[e],a=c.分类名;b=c.类型;this.add_cell(a,b);this.stData[a]=b}},init_cell:function(){var f=this.options,e=GlobalManage.clone(f.norList||[]),d,b,c,g=e.length;if(g==0)for(var a=0;a<f.norNum;a++)this.add_cell("","");else for(var a=0;a<g;a++){d=e[a];b=d.分类名||"";c=d.类型||"";this.add_cell(b,c);this.stData[b]=c}},mouse_cell:function(a,f){var b=a.children("a.fl-del");switch(f){case"mouse-over":var c=a.children("input[type=text]"),d=this.options,e=this.ordNum;if(e<=d.minNum)return;b.addClass("fl-del-show").css({left:c.width()+38});break;case"mouse-out":b.removeClass("fl-del-show")}},init_input:function(c){var a=this,d=a.options,b=c.children("input");b.change(function(){a.edit_input(c,b,b.val(),true);a.after_Update()}).blur(function(){a.edit_input(c,b,b.val(),true);a.after_Update()}).focusin(function(){a.focus_input(b,"focus-in")}).focusout(function(){a.focus_input(b,"focus-out")}).autocomplete(LKConfig.URLAssembly.LKSort.Server.get("Autocomplete"),{max:d.auto_maxNum,searchMax:d.auto_seaNum,width:d.inp_width+10,scrollHeight:d.auto_scrollHeight,cacheLength:d.auto_cacheLength,afterSTData:function(h,e,g){if(!g)for(var f,d=0;d<e.length;d++){f=e[d];a.stData[f.分类名]=""}a.edit_input(c,b,b.val(),false)},afterChange:function(d){a.edit_input(c,b,d,true);a.after_Update()}})},edit_input:function(c,b,a,d){d&&b.val(a);var f=this.stData,g=f[a]||"",e=this.get_ordNum(c);this.save_data(e,a,g);this.update_cell_st()},focus_input:function(a,d){var b=a.prev("label.fl-stype"),c=GlobalManage.trim(a.val());switch(d){case"focus-in":b.css("display","none");a.addClass("fl-sfocus");break;case"focus-out":c==""&&b.css("display","inline");a.removeClass("fl-sfocus")}},update_cell_st:function(){var m=this.data,f,c,d,k=this.ordNum,l=this.stData,b={},j=this.get_elem_list(),e;this.data={};for(var a=0;a<k;a++){f=m[a]||{};c=f.分类名;d=l[c]||"";f.类型=d;e=j.children("div.fl-cell:eq("+a+")");if(c!=""){this.save_data(a,c,d);var i=e.children("span.fl-stype");if(d)i.text("");else i.text("")}else b[a]=e}for(var g in b){var h=this.get_cur_st();this.save_data(g,"",h);b[g].children("label.fl-stype").text(h);b[g].children("span.fl-stype").text("")}},after_Update:function(){var d=this.data||{},b,c=this.options,a=[];for(var f in d){b=GlobalManage.trim(d[f].分类名);b!=""&&a.push({分类名:b})}if(a.length==0)for(var e=0;e<c.norNum;e++)a.push({分类名:""});c.afterUpdate&&c.afterUpdate(GlobalManage.clone(a))},is_FLZJSY_Js:false,zJSY_IFRAME:0,load_FLZJSY_Js:function(b){if(this.is_FLZJSY_Js){b();return}var a=this;$.getScript(LKConfig.URLAssembly.LKSort.JavaScript.get("ZJSY"),function(){a.is_FLZJSY_Js=true;a.zJSY_IFRAME=new LKSortZJSY_IFRAME;b()},false)},show_FLZJSY:function(){var a=this;this.load_FLZJSY_Js(function(){a.zJSY_IFRAME.loadIFrame(function(){a.zJSY_IFRAME.show_iframe(GlobalManage.clone(a.data),a.options.maxNum)},function(b){a.data=GlobalManage.clone(b);a.update_cell();a.after_Update()})})}}